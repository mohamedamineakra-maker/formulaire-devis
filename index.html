<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire Devis - ETS Saunier</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
    /* RESET CSS pour isoler le formulaire */
    #saunier-form-container * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
    }

    #saunier-form-container {
        all: initial;
        display: block;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }

    /* --- CONTENEUR PRINCIPAL PLUS GRAND --- */
    #saunier-form-container .form-card {
        background: white;
        border-radius: 16px;
        padding: 28px 32px;
        box-shadow: 
            0 1px 3px rgba(0, 0, 0, 0.12),
            0 10px 25px rgba(255, 87, 34, 0.08);
        max-width: 650px;
        width: 100%;
        margin: 0 auto;
        overflow: hidden;
        max-height: 95vh;
        display: flex;
        flex-direction: column;
    }

    #saunier-form-container .form-header {
        margin-bottom: 16px;
        flex-shrink: 0;
    }

    #saunier-form-container .form-badge {
        display: inline-block;
        background: linear-gradient(135deg, #FF6B35 0%, #FF5722 100%);
        color: white;
        padding: 5px 12px;
        border-radius: 25px;
        font-size: 9px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        margin-bottom: 8px;
        box-shadow: 0 4px 12px rgba(255, 87, 34, 0.3);
    }

    #saunier-form-container .form-title {
        font-size: 19px;
        font-weight: 800;
        color: #1a1a1a;
        margin-bottom: 4px;
        line-height: 1.3;
        letter-spacing: -0.5px;
    }

    #saunier-form-container .form-subtitle {
        font-size: 11px;
        color: #666;
        font-weight: 400;
    }

    #saunier-form-container .step {
        display: none;
        overflow-y: auto;
        overflow-x: hidden;
        max-height: calc(95vh - 220px);
        padding-right: 10px;
    }

    #saunier-form-container .step.active {
        display: block;
        animation: fadeInUp 0.4s ease;
    }

    /* Scrollbar personnalis√©e */
    #saunier-form-container .step::-webkit-scrollbar {
        width: 6px;
    }

    #saunier-form-container .step::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    #saunier-form-container .step::-webkit-scrollbar-thumb {
        background: #FF5722;
        border-radius: 10px;
    }

    #saunier-form-container .step::-webkit-scrollbar-thumb:hover {
        background: #E64A19;
    }

    @keyframes fadeInUp {
        from { 
            opacity: 0; 
            transform: translateX(20px);
        }
        to { 
            opacity: 1; 
            transform: translateX(0);
        }
    }

    #saunier-form-container .form-group {
        margin-bottom: 14px;
        position: relative;
    }

    /* Ligne pour mettre 2 champs c√¥te √† c√¥te */
    #saunier-form-container .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 14px;
    }

    #saunier-form-container .form-row .form-group {
        margin-bottom: 0;
    }

    @media (max-width: 450px) {
        #saunier-form-container .form-row {
            grid-template-columns: 1fr;
            gap: 14px;
        }
    }

    /* --- GRILLES AVEC PLUS D'A√âRATION --- */
    #saunier-form-container .quantities-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-bottom: 16px;
    }

    #saunier-form-container .quantity-item {
        background: #fafafa;
        border: 1px solid #e8e8e8;
        border-radius: 8px;
        padding: 8px 6px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    #saunier-form-container .quantity-item.selected {
        border-color: #FF5722;
        background: #FFF5F2;
        box-shadow: 0 4px 12px rgba(255, 87, 34, 0.15);
    }

    #saunier-form-container .quantity-item:hover {
        border-color: #FF5722;
        background: #fff;
        box-shadow: 0 4px 12px rgba(255, 87, 34, 0.2);
        transform: translateY(-2px);
    }

    #saunier-form-container .quantity-item:active {
        transform: translateY(0);
    }

    /* --- IC√îNES OPTIMIS√âES --- */
    #saunier-form-container .quantity-icon {
        color: #FF5722;
        margin-bottom: 4px;
        display: flex;
        justify-content: center;
    }

    #saunier-form-container .quantity-icon svg {
        width: 26px;
        height: 26px;
    }

    #saunier-form-container .quantity-label {
        font-weight: 600;
        color: #1a1a1a;
        font-size: 11px;
        margin-bottom: 5px;
        min-height: 22px;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1.2;
    }

    /* --- BOUTONS + / - OPTIMIS√âS --- */
    #saunier-form-container .quantity-controls {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
    }

    #saunier-form-container .qty-btn {
        width: 24px;
        height: 24px;
        border: 1px solid #e8e8e8;
        background: white;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        color: #FF5722;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        min-width: 24px;
        min-height: 24px;
    }

    #saunier-form-container .qty-btn:hover {
        border-color: #FF5722;
        background: #FF5722;
        color: white;
        transform: scale(1.1) rotate(3deg);
        box-shadow: 0 2px 8px rgba(255, 87, 34, 0.3);
    }

    #saunier-form-container .qty-btn:active {
        transform: scale(0.95);
    }

    /* Animation bounce au clic */
    @keyframes btnBounce {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.15); }
    }

    #saunier-form-container .qty-btn.bounce {
        animation: btnBounce 0.3s ease;
    }

    #saunier-form-container .quantity-controls input {
        width: 30px;
        text-align: center;
        font-size: 13px;
        font-weight: 700;
        border: none;
        padding: 0;
        color: #1a1a1a;
        background: transparent;
        transition: all 0.2s ease;
    }

    /* Animation pulse sur le nombre */
    @keyframes numberPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.3); color: #FF5722; }
    }

    #saunier-form-container .quantity-controls input.pulse {
        animation: numberPulse 0.3s ease;
    }

    /* --- OPTION CARDS AVEC PLUS D'A√âRATION --- */
    #saunier-form-container .options-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
    }

    /* GRILLE SP√âCIALE √âTAPE 0 : 1 colonne sur mobile, 3 sur desktop */
    #saunier-form-container .needs-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 14px;
        margin-bottom: 16px;
    }

    @media (min-width: 450px) {
        #saunier-form-container .needs-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    #saunier-form-container .option-card {
        border: 1px solid #e8e8e8;
        border-radius: 8px;
        padding: 8px 6px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
        background: #fafafa;
    }

    /* Cartes plus grandes pour l'√©tape 0 */
    #saunier-form-container .need-card {
        border: 2px solid #e8e8e8;
        border-radius: 12px;
        padding: 14px 12px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        position: relative;
        background: #fafafa;
    }

    #saunier-form-container .need-card:hover {
        border-color: #FF5722;
        background: white;
        transform: translateY(-2px);
        box-shadow: 
            0 2px 8px rgba(0, 0, 0, 0.1),
            0 8px 20px rgba(255, 87, 34, 0.2);
    }

    #saunier-form-container .need-card:active {
        transform: translateY(0);
    }

    #saunier-form-container .need-card.selected {
        border-color: #FF5722;
        background: #FFF5F2;
        box-shadow: 
            0 2px 8px rgba(0, 0, 0, 0.08),
            0 6px 16px rgba(255, 87, 34, 0.25);
    }

    /* Animation checkmark pour les cartes s√©lectionn√©es */
    #saunier-form-container .need-card.selected::after,
    #saunier-form-container .option-card.selected::after {
        content: '‚úì';
        position: absolute;
        top: 4px;
        right: 4px;
        width: 18px;
        height: 18px;
        background: #4CAF50;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 700;
        animation: checkmarkPop 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes checkmarkPop {
        0% { transform: scale(0) rotate(0deg); }
        50% { transform: scale(1.2) rotate(180deg); }
        100% { transform: scale(1) rotate(360deg); }
    }

    #saunier-form-container .need-card .icon {
        font-size: 32px;
        margin-bottom: 8px;
        color: #FF5722;
    }

    #saunier-form-container .need-card .icon svg {
        width: 36px;
        height: 36px;
    }

    #saunier-form-container .need-card .title {
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 4px;
        font-size: 13px;
        line-height: 1.3;
    }

    #saunier-form-container .need-card .description {
        font-size: 10px;
        color: #666;
        line-height: 1.4;
    }

    #saunier-form-container .option-card:hover {
        border-color: #FF5722;
        background: white;
        transform: translateY(-2px);
        box-shadow: 
            0 2px 6px rgba(0, 0, 0, 0.08),
            0 6px 16px rgba(255, 87, 34, 0.15);
    }

    #saunier-form-container .option-card:active {
        transform: translateY(0);
    }

    #saunier-form-container .option-card.selected {
        border-color: #FF5722;
        background: #FFF5F2;
        box-shadow: 0 4px 12px rgba(255, 87, 34, 0.2);
    }

    #saunier-form-container .option-card input[type="checkbox"],
    #saunier-form-container .option-card input[type="radio"],
    #saunier-form-container .need-card input[type="radio"] {
        position: absolute;
        opacity: 0;
    }

    #saunier-form-container .option-card .icon {
        font-size: 24px;
        margin-bottom: 4px;
        color: #FF5722;
    }

    #saunier-form-container .option-card .icon svg {
        width: 28px;
        height: 28px;
    }

    #saunier-form-container .option-card .title {
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 2px;
        font-size: 11px;
        line-height: 1.2;
    }

    #saunier-form-container .option-card .description {
        font-size: 9px;
        color: #666;
    }

    /* --- INPUTS & SELECTS PLUS GRANDS --- */
    #saunier-form-container label {
        display: block;
        margin-bottom: 6px;
        color: #1a1a1a;
        font-weight: 500;
        font-size: 13px;
    }

    #saunier-form-container input[type="text"],
    #saunier-form-container input[type="email"],
    #saunier-form-container input[type="tel"],
    #saunier-form-container select,
    #saunier-form-container textarea {
        width: 100%;
        padding: 12px 14px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.2s ease;
        background: white;
    }

    #saunier-form-container input:focus,
    #saunier-form-container select:focus,
    #saunier-form-container textarea:focus {
        outline: none;
        border-color: #FF5722;
        box-shadow: 0 0 0 3px rgba(255, 87, 34, 0.1);
    }

    #saunier-form-container textarea {
        resize: vertical;
        min-height: 70px;
    }

    /* --- BOUTONS NAVIGATION PLUS GRANDS --- */
    #saunier-form-container .btn {
        width: 100%;
        padding: 12px 18px;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    #saunier-form-container .btn-primary {
        background: #FF5722;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
    }

    #saunier-form-container .btn-primary:hover {
        background: #E64A19;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 87, 34, 0.3);
    }

    #saunier-form-container .buttons {
        display: flex;
        gap: 10px;
        margin-top: 16px;
        flex-shrink: 0;
    }

    #saunier-form-container .btn-secondary {
        background: #f5f5f5;
        color: #333;
        flex: 0 0 auto;
        width: auto;
    }

    #saunier-form-container .btn-secondary:hover {
        background: #e0e0e0;
    }

    /* --- BARRE DE PROGRESSION PLUS A√âR√âE --- */
    #saunier-form-container .progress-container {
        margin-bottom: 14px;
        flex-shrink: 0;
    }

    #saunier-form-container .progress-bar-wrapper {
        width: 100%;
        height: 6px;
        background: #e0e0e0;
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 6px;
    }

    #saunier-form-container .progress-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #FF6B35 0%, #FF5722 50%, #E64A19 100%);
        background-size: 200% 100%;
        border-radius: 10px;
        transition: width 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        width: 0%;
        animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }

    #saunier-form-container .progress-text {
        text-align: center;
        font-size: 11px;
        color: #999;
        font-weight: 500;
    }

    #saunier-form-container .progress-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    #saunier-form-container .time-remaining {
        font-size: 11px;
        color: #FF5722;
        font-weight: 600;
        padding: 4px 10px;
        background: #FFF5F2;
        border-radius: 10px;
        animation: timePulse 2s infinite;
    }

    @keyframes timePulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }

    #saunier-form-container .step-indicator {
        text-align: center;
        color: #555;
        font-size: 15px;
        font-weight: 600;
        margin-bottom: 14px;
    }

    /* --- MESSAGES ERREUR/SUCC√àS --- */
    #saunier-form-container .error-message {
        color: #f44336;
        font-size: 9px;
        margin-top: 2px;
        display: none;
    }

    #saunier-form-container .form-group.error .error-message {
        display: block;
    }
    
    #saunier-form-container .form-group.error input,
    #saunier-form-container .form-group.error select {
        border-color: #f44336;
    }

    #saunier-form-container .step-error-message {
        color: #f44336;
        background: #ffebee;
        border-left: 3px solid #f44336;
        padding: 6px 10px;
        border-radius: 5px;
        font-size: 11px;
        font-weight: 500;
        margin-top: 8px;
    }

    #saunier-form-container .success-icon-inline {
        position: absolute;
        right: 10px;
        top: 28px;
        color: #4CAF50;
        font-size: 13px;
        display: none;
    }

    #saunier-form-container .form-group.success .success-icon-inline {
        display: block;
    }

    /* --- FILE UPLOAD --- */
    #saunier-form-container .file-upload-wrapper {
        border: 1px dashed #e0e0e0;
        border-radius: 6px;
        padding: 12px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    #saunier-form-container .file-upload-wrapper:hover {
        border-color: #FF5722;
        background: #FFF5F2;
    }

    #saunier-form-container .uploaded-file {
        padding: 5px;
        background: #f8f9fa;
        border-radius: 4px;
        margin-bottom: 3px;
        font-size: 9px;
        display: flex;
        align-items: center;
    }
    
    #saunier-form-container .uploaded-file-remove {
        margin-left: auto;
        cursor: pointer;
        color: #f44336;
    }

    /* --- FOOTER & RESPONSIVE --- */
    #saunier-form-container .form-footer {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
        margin-top: 8px;
        font-size: 9px;
        color: #999;
        flex-wrap: wrap;
        flex-shrink: 0;
    }

    #saunier-form-container .form-footer svg {
        width: 10px;
        height: 10px;
    }

    /* Checkbox RGPD PLUS GRANDE */
    #saunier-form-container .checkbox-group {
        display: flex;
        align-items: start;
        gap: 10px;
        margin-top: 12px;
    }
    
    #saunier-form-container .checkbox-group input {
        margin-top: 3px;
        width: 18px;
        height: 18px;
        cursor: pointer;
        flex-shrink: 0;
    }

    #saunier-form-container .checkbox-group label {
        font-size: 13px;
        font-weight: 400;
        color: #333;
        line-height: 1.6;
        cursor: pointer;
    }

    #saunier-form-container .checkbox-group label a {
        color: #FF5722;
        text-decoration: underline;
        font-weight: 500;
    }

    #saunier-form-container .checkbox-group label a:hover {
        color: #E64A19;
    }

    /* Badges de r√©assurance */
    #saunier-form-container .reassurance-badges {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        margin-top: 12px;
        padding: 10px;
        background: #FFF9F5;
        border-radius: 8px;
        border: 1px solid #FFE5E0;
    }

    #saunier-form-container .reassurance-item {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    #saunier-form-container .reassurance-icon {
        color: #4CAF50;
        font-weight: 700;
        font-size: 13px;
    }

    #saunier-form-container .reassurance-text {
        font-size: 10px;
        font-weight: 600;
        color: #333;
    }

    @media (max-width: 450px) {
        #saunier-form-container .reassurance-badges {
            flex-direction: column;
            gap: 6px;
            padding: 8px;
        }
    }

    /* ============================================ */
    /* üé® AM√âLIORATIONS GRAPHIQUES - 3 SECTIONS    */
    /* ============================================ */

    /* 1Ô∏è‚É£ POP-UP "PROJET URGENT" - Version ultra sobre et douce */
    #saunier-form-container .project-score {
        display: none;
        background: #FFF3E0;
        border: 1px solid #FFB74D;
        border-radius: 5px;
        padding: 8px 10px;
        margin-top: 8px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    #saunier-form-container .project-score-icon {
        font-size: 16px;
        flex-shrink: 0;
        opacity: 0.9;
    }

    #saunier-form-container .project-score-text {
        color: #E65100;
        text-align: left;
        flex: 1;
        font-size: 11px;
        line-height: 1.4;
    }

    #saunier-form-container .project-score-text strong {
        font-size: 11px;
        font-weight: 600;
        display: inline;
        margin-right: 3px;
    }

    #saunier-form-container .project-score-text br {
        display: none;
    }

    /* 2Ô∏è‚É£ R√âCAPITULATIF - Version compacte */
    #saunier-form-container .recap-section {
        background: #FFF9F5;
        border: 1.5px solid #FF5722;
        border-radius: 6px;
        padding: 10px;
        margin-bottom: 10px;
        box-shadow: 0 1px 4px rgba(255, 87, 34, 0.08);
    }

    #saunier-form-container .recap-title {
        font-size: 12px;
        font-weight: 600;
        color: #FF5722;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    #saunier-form-container #recapContent {
        background: white;
        border-radius: 5px;
        padding: 8px;
        margin-bottom: 8px;
    }

    #saunier-form-container .recap-item {
        padding: 5px 8px;
        margin-bottom: 3px;
        background: #fafafa;
        border-left: 2px solid #FF5722;
        border-radius: 3px;
        font-size: 11px;
        color: #333;
        transition: background 0.2s ease;
    }

    #saunier-form-container .recap-item:hover {
        background: #FFF5F2;
    }

    #saunier-form-container .recap-item:last-child {
        margin-bottom: 0;
    }

    #saunier-form-container .recap-edit {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 3px;
        padding: 5px 10px;
        background: white;
        color: #FF5722;
        border: 1px solid #FF5722;
        border-radius: 4px;
        font-size: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        width: 100%;
        text-align: center;
    }

    #saunier-form-container .recap-edit:hover {
        background: #FF5722;
        color: white;
    }

    /* 3Ô∏è‚É£ PAGE DE CONFIRMATION - Design sobre et professionnel */
    #saunier-form-container .success-message {
        text-align: center;
        padding: 30px 16px;
        background: #FFF9F5;
        border-radius: 10px;
        border: 2px solid #4CAF50;
    }

    #saunier-form-container .success-icon {
        width: 60px;
        height: 60px;
        margin: 0 auto 16px;
        background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        animation: scaleIn 0.4s ease;
    }

    @keyframes scaleIn {
        0% { transform: scale(0); opacity: 0; }
        100% { transform: scale(1); opacity: 1; }
    }

    #saunier-form-container .success-icon svg {
        width: 30px;
        height: 30px;
        stroke: white;
        stroke-width: 3;
        fill: none;
        animation: checkmark 0.5s ease 0.2s both;
    }

    @keyframes checkmark {
        0% { stroke-dasharray: 0 100; }
        100% { stroke-dasharray: 100 100; }
    }

    #saunier-form-container .success-message h2 {
        font-size: 20px;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 10px;
    }

    #saunier-form-container .success-message p {
        font-size: 13px;
        color: #555;
        line-height: 1.6;
        margin-bottom: 10px;
    }

    #saunier-form-container .success-message p strong {
        color: #FF5722;
        font-weight: 600;
    }

    /* Badge contact */
    #saunier-form-container .success-message .success-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: white;
        padding: 8px 16px;
        border-radius: 18px;
        margin-top: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border: 1px solid #e8e8e8;
    }

    #saunier-form-container .success-message .success-badge::before {
        content: 'üìû';
        font-size: 16px;
    }

    #saunier-form-container .success-message .success-badge-text {
        font-size: 11px;
        font-weight: 600;
        color: #333;
    }

    /* MOBILE : ADAPTATION √Ä LA TAILLE R√âDUITE */
    @media (max-width: 700px) {
        #saunier-form-container .form-card {
            max-width: 100%;
            padding: 24px;
        }
        
        #saunier-form-container .quantities-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        #saunier-form-container .options-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        #saunier-form-container .step {
            max-height: calc(95vh - 200px);
        }
        
        #saunier-form-container .buttons {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 14px 0;
            margin-left: -24px;
            margin-right: -24px;
            padding-left: 24px;
            padding-right: 24px;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.05);
            z-index: 10;
            border-top: 1px solid #f0f0f0;
        }

        #saunier-form-container .success-icon {
            width: 65px;
            height: 65px;
        }

        #saunier-form-container .success-icon svg {
            width: 30px;
            height: 30px;
        }

        #saunier-form-container .success-message h2 {
            font-size: 20px;
        }

        #saunier-form-container .success-message p {
            font-size: 14px;
        }
    }
</style>
</head>
<body>
    <div id="saunier-form-container">
        <div class="form-card">
            <div class="form-header">
                <div class="form-badge">üìã OBTENEZ VOTRE DEVIS</div>
                <h2 class="form-title">Votre projet, notre expertise</h2>
                <p class="form-subtitle">Faisons le point ensemble</p>
            </div>

            <div class="progress-container">
                <div class="progress-bar-wrapper">
                    <div class="progress-bar-fill" id="progressBarFill"></div>
                </div>
                <div class="progress-info">
                    <div class="progress-text" id="progressText">√âtape 1 sur 7 ‚Ä¢ 14% compl√©t√©</div>
                    <div class="time-remaining" id="timeRemaining">‚è±Ô∏è ~2 min</div>
                </div>
            </div>

            <form id="devisForm">
                <input type="text" name="_honeypot" style="display:none !important" tabindex="-1" autocomplete="off">

                <!-- √âTAPE 0 : TYPE DE BESOIN -->
                <div class="step active" data-step="0">
                    <div class="step-indicator">üéØ Quel est votre besoin ?</div>
                    
                    <div class="needs-grid">
                        <label class="need-card" data-need-type="installation">
                            <input type="radio" name="typeProjet" value="installation" required>
                            <div class="icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="12" y="16" width="40" height="36" rx="3" fill="#FFE5E0" stroke="currentColor" stroke-width="2.5"/>
                                    <rect x="20" y="24" width="10" height="12" rx="1" fill="white" stroke="currentColor" stroke-width="2"/>
                                    <rect x="34" y="24" width="10" height="12" rx="1" fill="white" stroke="currentColor" stroke-width="2"/>
                                    <rect x="20" y="40" width="24" height="2" fill="currentColor"/>
                                    <path d="M32 8L16 16h32L32 8z" fill="#FF5722"/>
                                </svg>
                            </div>
                            <div class="title">Installation / R√©novation</div>
                            <div class="description">Projet complet de menuiseries</div>
                        </label>

                        <label class="need-card" data-need-type="depannage">
                            <input type="radio" name="typeProjet" value="depannage" required>
                            <div class="icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <circle cx="32" cy="32" r="20" fill="#FFE5E0" stroke="currentColor" stroke-width="2.5"/>
                                    <path d="M32 20v16l8 8" stroke="#FF5722" stroke-width="3" stroke-linecap="round"/>
                                    <path d="M28 18l-4-4M36 18l4-4M18 28l-4-4M46 28l4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </div>
                            <div class="title">D√©pannage / R√©paration</div>
                            <div class="description">Intervention rapide urgente</div>
                        </label>

                        <label class="need-card" data-need-type="autre">
                            <input type="radio" name="typeProjet" value="autre" required>
                            <div class="icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <circle cx="32" cy="32" r="20" fill="#FFE5E0" stroke="currentColor" stroke-width="2.5"/>
                                    <path d="M22 28c2-4 8-4 10 0M42 28c-2-4-8-4-10 0" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
                                    <ellipse cx="26" cy="26" rx="2" ry="3" fill="currentColor"/>
                                    <ellipse cx="38" cy="26" rx="2" ry="3" fill="currentColor"/>
                                    <path d="M24 40c2 4 14 4 16 0" stroke="#FF5722" stroke-width="2.5" stroke-linecap="round"/>
                                </svg>
                            </div>
                            <div class="title">Autre demande</div>
                            <div class="description">Conseil ou question sp√©cifique</div>
                        </label>
                    </div>

                    <div class="step-error-message" id="step0Error" style="display: none;">
                        ‚ö†Ô∏è Veuillez s√©lectionner le type de votre besoin
                    </div>
                </div>

                <!-- √âTAPE 1 : MENUISERIES (seulement si installation) -->
                <div class="step" data-step="1">
                    <div class="step-indicator">ü™ü Vos menuiseries</div>
                    
                    <div class="quantities-grid">
                        <div class="quantity-item" data-type="fenetres">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="12" y="8" width="40" height="48" rx="3" fill="#FFE5E0" stroke="currentColor" stroke-width="2"/>
                                    <line x1="32" y="8" x2="32" y2="56" stroke="currentColor" stroke-width="2"/>
                                    <line x1="12" y1="32" x2="52" y2="32" stroke="currentColor" stroke-width="2"/>
                                    <circle cx="40" cy="32" r="2" fill="currentColor"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Fen√™tre</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="fenetres">‚àí</button>
                                <input type="number" name="qty_fenetres" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="fenetres">+</button>
                            </div>
                        </div>

                        <div class="quantity-item" data-type="portefenetres">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="12" y="8" width="40" height="48" rx="3" fill="#FFE5E0" stroke="currentColor" stroke-width="2"/>
                                    <path d="M32 8v48" stroke="currentColor" stroke-width="2"/>
                                    <rect x="36" y="26" width="12" height="16" rx="1" fill="#FF5722" opacity="0.3"/>
                                    <circle cx="44" cy="34" r="1.5" fill="currentColor"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Porte-fen√™tre</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="portefenetres">‚àí</button>
                                <input type="number" name="qty_portefenetres" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="portefenetres">+</button>
                            </div>
                        </div>

                        <div class="quantity-item" data-type="baie">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="10" y="12" width="44" height="40" rx="3" fill="#FFE5E0" stroke="currentColor" stroke-width="2"/>
                                    <rect x="12" y="14" width="19" height="36" fill="white" opacity="0.7"/>
                                    <rect x="33" y="14" width="19" height="36" fill="white" opacity="0.4"/>
                                    <path d="M31 14v36" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Baie coulissante</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="baie">‚àí</button>
                                <input type="number" name="qty_baie" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="baie">+</button>
                            </div>
                        </div>

                        <div class="quantity-item" data-type="porteentree">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="16" y="8" width="32" height="48" rx="3" fill="#FF8A65" stroke="currentColor" stroke-width="2"/>
                                    <circle cx="40" cy="34" r="2" fill="white"/>
                                    <rect x="20" y="16" width="24" height="10" rx="1.5" fill="#FFE5E0"/>
                                    <path d="M26 34h12M26 38h12M26 42h12" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Porte d'entr√©e</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="porteentree">‚àí</button>
                                <input type="number" name="qty_porteentree" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="porteentree">+</button>
                            </div>
                        </div>

                        <div class="quantity-item" data-type="garage">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="10" y="10" width="44" height="44" rx="3" fill="#FF8A65" stroke="currentColor" stroke-width="2"/>
                                    <rect x="10" y="10" width="44" height="6" fill="#FF5722"/>
                                    <path d="M10 20h44M10 26h44M10 32h44M10 38h44M10 44h44M10 50h44" stroke="#D84315" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Porte de garage</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="garage">‚àí</button>
                                <input type="number" name="qty_garage" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="garage">+</button>
                            </div>
                        </div>

                        <div class="quantity-item" data-type="voletroulant">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="16" y="18" width="32" height="36" rx="2" fill="#FFE5E0" stroke="currentColor" stroke-width="2"/>
                                    <rect x="18" y="10" width="28" height="10" rx="2" fill="#FF8A65" stroke="currentColor" stroke-width="2"/>
                                    <path d="M18 24h28M18 28h28M18 32h28M18 36h28M18 40h28M18 44h28" stroke="#FF5722" stroke-width="1.5"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Volet roulant</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="voletroulant">‚àí</button>
                                <input type="number" name="qty_voletroulant" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="voletroulant">+</button>
                            </div>
                        </div>

                        <div class="quantity-item" data-type="voletbattant">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="8" y="12" width="20" height="40" rx="2" fill="#FF8A65" stroke="currentColor" stroke-width="2"/>
                                    <rect x="36" y="12" width="20" height="40" rx="2" fill="#FF8A65" stroke="currentColor" stroke-width="2"/>
                                    <path d="M10 20h16M10 26h16M10 32h16M10 38h16M10 44h16" stroke="#D84315" stroke-width="1.5"/>
                                    <path d="M38 20h16M38 26h16M38 32h16M38 38h16M38 44h16" stroke="#D84315" stroke-width="1.5"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Volet battant</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="voletbattant">‚àí</button>
                                <input type="number" name="qty_voletbattant" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="voletbattant">+</button>
                            </div>
                        </div>

                        <div class="quantity-item" data-type="portail">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="8" y="16" width="22" height="36" rx="2" fill="#FF8A65" stroke="currentColor" stroke-width="2"/>
                                    <rect x="34" y="16" width="22" height="36" rx="2" fill="#FF8A65" stroke="currentColor" stroke-width="2"/>
                                    <path d="M10 24h18M10 32h18M10 40h18" stroke="#D84315" stroke-width="2"/>
                                    <path d="M36 24h18M36 32h18M36 40h18" stroke="#D84315" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Portail / Cl√¥ture</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="portail">‚àí</button>
                                <input type="number" name="qty_portail" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="portail">+</button>
                            </div>
                        </div>

                        <div class="quantity-item" data-type="pergola">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="8" y="16" width="48" height="36" rx="3" fill="#FFE5E0" stroke="currentColor" stroke-width="2"/>
                                    <line x1="8" y1="16" x2="8" y2="52" stroke="currentColor" stroke-width="3"/>
                                    <line x1="56" y1="16" x2="56" y2="52" stroke="currentColor" stroke-width="3"/>
                                    <path d="M12 22h40M12 28h40M12 34h40" stroke="#FF5722" stroke-width="1.5" opacity="0.5"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Pergola / V√©randa</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="pergola">‚àí</button>
                                <input type="number" name="qty_pergola" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="pergola">+</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <input type="text" name="autreProjet" placeholder="Autre projet √† pr√©ciser ? (optionnel)">
                    </div>

                    <div class="step-error-message" id="step1Error" style="display: none;">
                        ‚ö†Ô∏è Veuillez s√©lectionner au moins une menuiserie
                    </div>
                </div>

                <!-- √âTAPE 2 : MAT√âRIAUX (seulement si installation) -->
                <div class="step" data-step="2">
                    <div class="step-indicator">üîß Mat√©riau(x) souhait√©(s)</div>
                    
                    <div class="form-group">
                        <label style="margin-bottom: 10px; text-align: center; display: block;">Vous pouvez s√©lectionner plusieurs mat√©riaux</label>
                        <div class="options-grid">
                            <label class="option-card">
                                <input type="checkbox" name="materiau_pvc" value="pvc">
                                <div class="icon">
                                    <svg width="40" height="40" viewBox="0 0 56 56" fill="none">
                                        <rect x="10" y="10" width="36" height="36" rx="4" fill="#FFE5E0" stroke="currentColor" stroke-width="3"/>
                                        <path d="M10 22h36M22 10v36" stroke="currentColor" stroke-width="2.5"/>
                                    </svg>
                                </div>
                                <div class="title">PVC</div>
                                <div class="description">Optimal</div>
                            </label>
                            
                            <label class="option-card">
                                <input type="checkbox" name="materiau_aluminium" value="aluminium">
                                <div class="icon">
                                    <svg width="40" height="40" viewBox="0 0 56 56" fill="none">
                                        <rect x="10" y="10" width="36" height="36" rx="3" fill="#CFD8DC" stroke="#607D8B" stroke-width="3"/>
                                        <circle cx="28" cy="28" r="8" fill="#90A4AE" stroke="#607D8B" stroke-width="2"/>
                                    </svg>
                                </div>
                                <div class="title">Aluminium</div>
                                <div class="description">Moderne</div>
                            </label>
                            
                            <label class="option-card">
                                <input type="checkbox" name="materiau_bois" value="bois">
                                <div class="icon">
                                    <svg width="40" height="40" viewBox="0 0 56 56" fill="none">
                                        <rect x="10" y="10" width="36" height="36" rx="4" fill="#EFEBE9" stroke="#795548" stroke-width="3"/>
                                        <line x1="18" y="10" x2="18" y2="46" stroke="#A1887F" stroke-width="2.5"/>
                                        <line x1="28" y="10" x2="28" y2="46" stroke="#A1887F" stroke-width="2.5"/>
                                        <line x1="38" y="10" x2="38" y2="46" stroke="#A1887F" stroke-width="2.5"/>
                                    </svg>
                                </div>
                                <div class="title">Bois</div>
                                <div class="description">Chaleureux</div>
                            </label>
                            
                            <label class="option-card">
                                <input type="checkbox" name="materiau_mixte" value="mixte">
                                <div class="icon">
                                    <svg width="40" height="40" viewBox="0 0 56 56" fill="none">
                                        <rect x="10" y="10" width="16" height="36" rx="2" fill="#EFEBE9" stroke="#795548" stroke-width="2.5"/>
                                        <rect x="30" y="10" width="16" height="36" rx="2" fill="#CFD8DC" stroke="#607D8B" stroke-width="2.5"/>
                                        <line x1="14" y="10" x2="14" y2="46" stroke="#A1887F" stroke-width="2"/>
                                        <line x1="38" y="10" x2="38" y2="46" stroke="#607D8B" stroke-width="2"/>
                                    </svg>
                                </div>
                                <div class="title">Mixte</div>
                                <div class="description">Alu/Bois</div>
                            </label>
                            
                            <label class="option-card">
                                <input type="checkbox" name="materiau_indecis" value="indecis">
                                <div class="icon">
                                    <svg width="40" height="40" viewBox="0 0 56 56" fill="none">
                                        <circle cx="28" cy="28" r="18" fill="#FFF9C4" stroke="#FBC02D" stroke-width="3"/>
                                        <circle cx="22" cy="24" r="2.5" fill="#F57F17"/>
                                        <circle cx="34" cy="24" r="2.5" fill="#F57F17"/>
                                    </svg>
                                </div>
                                <div class="title">Conseillez-moi</div>
                            </label>
                        </div>
                    </div>

                    <div class="step-error-message" id="step2Error" style="display: none;">
                        ‚ö†Ô∏è Veuillez s√©lectionner au moins un mat√©riau
                    </div>
                </div>

                <!-- √âTAPE 3 : TYPE DE BIEN (seulement si installation) -->
                <div class="step" data-step="3">
                    <div class="step-indicator">üè† Type de bien</div>
                    
                    <div class="form-group">
                        <select name="typeBien" id="typeBienSelect">
                            <option value="">S√©lectionnez votre type de bien</option>
                            <option value="maison">Maison individuelle</option>
                            <option value="appartement">Appartement</option>
                            <option value="local">Local commercial</option>
                            <option value="neuf">Construction neuve</option>
                        </select>
                        <span class="error-message">Veuillez s√©lectionner un type de bien</span>
                    </div>
                </div>

                <!-- √âTAPE 4 : D√âLAI (pour installation uniquement) -->
                <div class="step" data-step="4">
                    <div class="step-indicator">üìÖ D√©lai souhait√©</div>
                    
                    <div class="form-group">
                        <select name="delai" id="delaiSelect">
                            <option value="">Dans quel d√©lai souhaitez-vous r√©aliser ?</option>
                            <option value="urgent">Le plus t√¥t possible (urgent)</option>
                            <option value="1-3mois">Dans 1 √† 3 mois</option>
                            <option value="3-6mois">Dans 3 √† 6 mois</option>
                            <option value="6mois+">Plus de 6 mois</option>
                        </select>
                        <span class="error-message">Veuillez s√©lectionner un d√©lai</span>
                    </div>

                    <div id="projectScore" class="project-score" style="display: none;">
                        <div class="project-score-icon">üî•</div>
                        <div class="project-score-text">
                            <strong>Projet urgent !</strong><br>
                            Nous vous recontactons en priorit√©
                        </div>
                    </div>
                </div>

                <!-- √âTAPE 5 : DESCRIPTION (pour d√©pannage/autre) -->
                <div class="step" data-step="5">
                    <div class="step-indicator">üìù D√©crivez votre besoin</div>
                    
                    <div class="form-group">
                        <label>Description du probl√®me / de votre demande *</label>
                        <textarea name="descriptionProbleme" id="descriptionProbleme" placeholder="D√©crivez votre situation en quelques mots..." required></textarea>
                        <span class="error-message">Veuillez d√©crire votre besoin</span>
                    </div>

                    <div class="form-group">
                        <label>Urgence de votre demande</label>
                        <select name="urgenceDepannage">
                            <option value="">S√©lectionnez le niveau d'urgence</option>
                            <option value="immediat">Tr√®s urgent (rappel prioritaire)</option>
                            <option value="urgent">Urgent (rappel rapide)</option>
                            <option value="normal">Normal</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Photos du probl√®me (recommand√©)</label>
                        <div class="file-upload-wrapper" onclick="document.getElementById('fileInputDepannage').click()">
                            <input type="file" id="fileInputDepannage" accept="image/*" multiple>
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Cliquez pour ajouter des photos<br><small>(JPG, PNG - Max 5 photos)</small></div>
                        </div>
                        <div class="uploaded-files" id="uploadedFilesDepannage"></div>
                    </div>
                </div>

                <!-- √âTAPE 6 : D√âTAILS DU PROJET (pour installation uniquement) -->
                <div class="step" data-step="6">
                    <div class="step-indicator">üìç D√©tails du projet (optionnel)</div>
                    
                    <div class="form-group">
                        <label>Budget pr√©visionnel (optionnel)</label>
                        <select name="budget">
                            <option value="">S√©lectionnez une fourchette</option>
                            <option value="moins-5000">Moins de 5 000 ‚Ç¨</option>
                            <option value="5000-10000">5 000 ‚Ç¨ - 10 000 ‚Ç¨</option>
                            <option value="10000-20000">10 000 ‚Ç¨ - 20 000 ‚Ç¨</option>
                            <option value="plus-20000">Plus de 20 000 ‚Ç¨</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Description du projet (optionnel)</label>
                        <textarea name="description" placeholder="Pr√©cisez vos besoins, contraintes sp√©cifiques, dimensions..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Photos du projet (optionnel)</label>
                        <div class="file-upload-wrapper" onclick="document.getElementById('fileInput').click()">
                            <input type="file" id="fileInput" accept="image/*" multiple>
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Cliquez pour ajouter des photos<br><small>(JPG, PNG - Max 5 photos)</small></div>
                        </div>
                        <div class="uploaded-files" id="uploadedFiles"></div>
                    </div>
                </div>

                <!-- √âTAPE 7 : COORDONN√âES (finale) -->
                <div class="step" data-step="7">
                    <div class="step-indicator">üéâ Derni√®re √©tape !</div>
                    
                    <div class="recap-section" id="recapSection" style="display: none;">
                        <div class="recap-title">R√©capitulatif de votre demande</div>
                        <div id="recapContent"></div>
                        <span class="recap-edit" onclick="goToStep(1)">‚úèÔ∏è Modifier</span>
                    </div>

                    <div class="form-group">
                        <label>Code postal *</label>
                        <input type="text" name="codePostalFinal" id="codePostalFinal" placeholder="Ex: 74000" required pattern="[0-9]{5}" maxlength="5">
                        <span class="error-message">Le code postal doit contenir 5 chiffres</span>
                        <span class="success-icon-inline">‚úì</span>
                    </div>

                    <div class="form-group" id="villeGroup" style="display: none;">
                        <label>Ville</label>
                        <input type="text" name="ville" id="ville" readonly style="background: #f5f5f5; cursor: default;">
                    </div>

                    <div class="form-group">
                        <label>T√©l√©phone *</label>
                        <input type="tel" name="telephone" id="telephone" placeholder="06 00 00 00 00" required pattern="[0-9]{10}" maxlength="10">
                        <span class="error-message">Le t√©l√©phone doit contenir 10 chiffres</span>
                        <span class="success-icon-inline">‚úì</span>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Nom *</label>
                            <input type="text" name="nom" id="nom" placeholder="Votre nom" required>
                            <span class="error-message">Le nom est requis</span>
                            <span class="success-icon-inline">‚úì</span>
                        </div>

                        <div class="form-group">
                            <label>Pr√©nom *</label>
                            <input type="text" name="prenom" id="prenom" placeholder="Votre pr√©nom" required>
                            <span class="error-message">Le pr√©nom est requis</span>
                            <span class="success-icon-inline">‚úì</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" name="email" id="email" placeholder="votre@email.fr">
                        <span class="error-message">Format d'email invalide</span>
                        <span class="success-icon-inline">‚úì</span>
                    </div>

                    <div class="form-group">
                        <label>Cr√©neau de rappel pr√©f√©r√© (optionnel)</label>
                        <select name="creneauRappel">
                            <option value="">Indiff√©rent</option>
                            <option value="matin">Matin (9h-12h)</option>
                            <option value="apres-midi">Apr√®s-midi (14h-17h)</option>
                            <option value="fin-journee">Fin de journ√©e (17h-19h)</option>
                        </select>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" name="rgpd" id="rgpd" required>
                        <label for="rgpd">J'accepte d'√™tre recontact√© pour ma demande de devis et j'ai lu et accept√© les <a href="https://ets-saunier.com/mentions-legales/" target="_blank" style="color: #FF5722; text-decoration: underline;">CGU et la politique de confidentialit√©</a></label>
                    </div>
                    <div class="step-error-message" id="rgpdError" style="display: none; margin-top: 8px;">
                        ‚ö†Ô∏è Vous devez accepter les CGU et la politique de confidentialit√© pour continuer
                    </div>

                    <div class="reassurance-badges">
                        <div class="reassurance-item">
                            <span class="reassurance-icon">‚úì</span>
                            <span class="reassurance-text">Gratuit</span>
                        </div>
                        <div class="reassurance-item">
                            <span class="reassurance-icon">‚úì</span>
                            <span class="reassurance-text">Sans engagement</span>
                        </div>
                        <div class="reassurance-item">
                            <span class="reassurance-icon">‚úì</span>
                            <span class="reassurance-text">Devis personnalis√©</span>
                        </div>
                    </div>
                </div>

                <!-- √âTAPE 8 : SUCC√àS -->
                <div class="step" data-step="8">
                    <div class="success-message">
                        <div class="success-icon">
                            <svg fill="none" viewBox="0 0 24 24">
                                <polyline points="20 6 9 17 4 12" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h2 id="successTitle">üéâ Demande envoy√©e !</h2>
                        <p id="successMessage">Merci pour votre confiance. Nous vous recontactons <strong>dans les meilleurs d√©lais</strong> pour affiner votre projet et vous proposer le meilleur devis.</p>
                        <div class="success-badge">
                            <span class="success-badge-text" id="successBadge">Un conseiller commercial vous contactera prochainement</span>
                        </div>
                    </div>
                </div>

                <div class="buttons" id="navigationButtons">
                    <button type="button" class="btn btn-secondary" id="prevBtn" style="display: none;">‚Üê Retour</button>
                    <button type="button" class="btn btn-primary" id="nextBtn">Continuer</button>
                </div>
            </form>

            <div class="form-footer">
                <div class="form-footer-item">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span>Devis sur mesure</span>
                </div>
                <span>‚Ä¢</span>
                <div class="form-footer-item">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                    </svg>
                    <span>Sans engagement</span>
                </div>
                <span>‚Ä¢</span>
                <div class="form-footer-item">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span>Gratuit</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            const form = document.getElementById('devisForm');
            const steps = document.querySelectorAll('#saunier-form-container .step');
            const nextBtn = document.getElementById('nextBtn');
            const prevBtn = document.getElementById('prevBtn');
            const navigationButtons = document.getElementById('navigationButtons');
            const progressBarFill = document.getElementById('progressBarFill');
            const progressText = document.getElementById('progressText');
            let currentStep = 0;
            let projectType = ''; // 'installation', 'depannage', ou 'autre'
            let startTime = Date.now();
            let uploadedFiles = [];
            let formStarted = false;

            // D√©finition du parcours des √©tapes selon le type de projet
            const stepFlow = {
                installation: [0, 1, 2, 3, 4, 6, 7, 8], // √âtape 0 -> Menuiseries -> Mat√©riaux -> Type bien -> D√©lai -> D√©tails -> Coordonn√©es -> Succ√®s
                depannage: [0, 5, 7, 8], // √âtape 0 -> Description -> Coordonn√©es -> Succ√®s
                autre: [0, 5, 7, 8] // √âtape 0 -> Description -> Coordonn√©es -> Succ√®s
            };

            let activeStepFlow = []; // Sera d√©fini apr√®s s√©lection du type de projet
            let currentFlowIndex = 0;

            // LocalStorage
            function saveProgress() {
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);
                data.currentStep = currentStep;
                data.projectType = projectType;
                data.uploadedFiles = uploadedFiles;
                localStorage.setItem('saunierFormData', JSON.stringify(data));
            }

            function loadProgress() {
                const saved = localStorage.getItem('saunierFormData');
                if (saved) {
                    const data = JSON.parse(saved);
                    Object.keys(data).forEach(key => {
                        if (key !== 'currentStep' && key !== 'projectType' && key !== 'uploadedFiles') {
                            const input = form.querySelector(`[name="${key}"]`);
                            if (input) {
                                if (input.type === 'checkbox') {
                                    if (data[key]) input.checked = true;
                                } else if (input.type === 'radio') {
                                    const radio = form.querySelector(`[name="${key}"][value="${data[key]}"]`);
                                    if (radio) radio.checked = true;
                                } else {
                                    input.value = data[key];
                                }
                            }
                        }
                    });
                    if (data.uploadedFiles) {
                        uploadedFiles = data.uploadedFiles;
                        displayUploadedFiles();
                    }
                    if (data.projectType) {
                        projectType = data.projectType;
                        activeStepFlow = stepFlow[projectType];
                    }
                }
            }

            function sendHeightToParent() {
                if (window.parent !== window) {
                    const height = document.body.scrollHeight;
                    window.parent.postMessage({ 
                        type: 'resize-iframe', 
                        height: height 
                    }, '*');
                }
            }

            const resizeObserver = new ResizeObserver(() => {
                sendHeightToParent();
            });
            resizeObserver.observe(document.getElementById('saunier-form-container'));
            
            window.addEventListener('load', () => {
                sendHeightToParent();
                
                // Am√©lioration 8 : Pr√©remplissage intelligent si retour
                const saved = localStorage.getItem('saunierFormData');
                if (saved) {
                    const lastVisit = localStorage.getItem('saunierLastVisit');
                    const now = Date.now();
                    const daysSinceLastVisit = lastVisit ? (now - parseInt(lastVisit)) / (1000 * 60 * 60 * 24) : 999;
                    
                    // Si derni√®re visite il y a moins de 7 jours
                    if (daysSinceLastVisit < 7) {
                        const shouldRestore = confirm('üëã On dirait que vous √©tiez d√©j√† venu !\n\nVoulez-vous reprendre l√† o√π vous en √©tiez ?');
                        if (shouldRestore) {
                            loadProgress();
                        } else {
                            localStorage.removeItem('saunierFormData');
                        }
                    } else {
                        // Trop vieux, on supprime
                        localStorage.removeItem('saunierFormData');
                    }
                }
                
                localStorage.setItem('saunierLastVisit', Date.now().toString());
            });

            // Validation temps r√©el
            function validateField(field) {
                const formGroup = field.closest('.form-group');
                if (!formGroup) return true;

                formGroup.classList.remove('error', 'success');

                if (field.hasAttribute('required') && !field.value.trim()) {
                    if (field.type !== 'checkbox') {
                        formGroup.classList.add('error');
                        return false;
                    }
                }

                if (field.type === 'email' && field.value) {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(field.value)) {
                        formGroup.classList.add('error');
                        return false;
                    }
                }

                if (field.pattern && field.value) {
                    const regex = new RegExp(field.pattern);
                    if (!regex.test(field.value)) {
                        formGroup.classList.add('error');
                        return false;
                    }
                }

                if (field.value) {
                    formGroup.classList.add('success');
                }

                return true;
            }

            document.querySelectorAll('#saunier-form-container input, #saunier-form-container select, #saunier-form-container textarea').forEach(field => {
                field.addEventListener('blur', () => validateField(field));
                field.addEventListener('input', () => {
                    if (field.closest('.form-group')?.classList.contains('error')) {
                        validateField(field);
                    }
                    saveProgress();
                });
            });

            // Auto-format t√©l√©phone
            const telInput = document.getElementById('telephone');
            if (telInput) {
                telInput.addEventListener('input', function(e) {
                    let value = this.value.replace(/\D/g, '');
                    if (value.length > 10) value = value.substr(0, 10);
                    this.value = value;
                });
            }

            // Auto-format code postal
            const cpInput = document.getElementById('codePostal');
            const cpFinalInput = document.getElementById('codePostalFinal');
            
            // Am√©lioration 3 : Auto-compl√©tion de la ville depuis le code postal
            async function fetchCityFromPostalCode(postalCode) {
                if (postalCode.length !== 5) return;
                
                try {
                    const response = await fetch(`https://api-adresse.data.gouv.fr/search/?q=${postalCode}&type=municipality&limit=1`);
                    
                    if (!response.ok) {
                        // API non disponible, on ignore silencieusement
                        return;
                    }
                    
                    const data = await response.json();
                    
                    if (data.features && data.features.length > 0) {
                        const city = data.features[0].properties.city;
                        const villeInput = document.getElementById('ville');
                        const villeGroup = document.getElementById('villeGroup');
                        
                        if (villeInput && villeGroup) {
                            villeInput.value = city;
                            villeGroup.style.display = 'block';
                            saveProgress();
                        }
                    }
                } catch (error) {
                    // Erreur r√©seau ou CORS - on ignore silencieusement
                    // L'utilisateur pourra quand m√™me soumettre le formulaire sans la ville
                    console.log('Info: Auto-compl√©tion ville non disponible');
                }
            }
            
            if (cpInput) {
                cpInput.addEventListener('input', function(e) {
                    let value = this.value.replace(/\D/g, '');
                    if (value.length > 5) value = value.substr(0, 5);
                    this.value = value;
                    
                    if (value.length === 5) {
                        fetchCityFromPostalCode(value);
                    }
                });
            }
            
            if (cpFinalInput) {
                cpFinalInput.addEventListener('input', function(e) {
                    let value = this.value.replace(/\D/g, '');
                    if (value.length > 5) value = value.substr(0, 5);
                    this.value = value;
                    
                    if (value.length === 5) {
                        fetchCityFromPostalCode(value);
                    }
                });
            }

            // Gestion des cartes d'options (CHECKBOXES pour mat√©riaux)
            document.querySelectorAll('#saunier-form-container .option-card').forEach(card => {
                card.addEventListener('click', function() {
                    const input = this.querySelector('input');
                    input.checked = !input.checked;
                    
                    if (input.checked) {
                        this.classList.add('selected');
                    } else {
                        this.classList.remove('selected');
                    }
                    
                    saveProgress();
                });
            });

            // Gestion des cartes de besoin (RADIO pour type de projet)
            document.querySelectorAll('#saunier-form-container .need-card').forEach(card => {
                card.addEventListener('click', function() {
                    const input = this.querySelector('input[type="radio"]');
                    
                    // Retirer la s√©lection des autres cartes
                    document.querySelectorAll('#saunier-form-container .need-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    
                    // S√©lectionner cette carte
                    this.classList.add('selected');
                    input.checked = true;
                    
                    // D√©finir le type de projet et le flux d'√©tapes
                    projectType = input.value;
                    activeStepFlow = stepFlow[projectType];
                    currentFlowIndex = 0;
                    
                    saveProgress();
                });
            });

            // Gestion quantit√©s
            document.querySelectorAll('#saunier-form-container .qty-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    if (!formStarted) {
                        formStarted = true;
                    }
                    
                    const target = this.dataset.target;
                    const input = document.querySelector(`#saunier-form-container input[name="qty_${target}"]`);
                    const quantityItem = input.closest('.quantity-item');
                    const currentValue = parseInt(input.value);
                    
                    // Am√©lioration 1 : Animation bounce sur le bouton
                    this.classList.add('bounce');
                    setTimeout(() => this.classList.remove('bounce'), 300);
                    
                    if (this.classList.contains('plus')) {
                        if (currentValue < 99) {
                            input.value = currentValue + 1;
                            input.classList.add('pulse');
                            setTimeout(() => input.classList.remove('pulse'), 300);
                        }
                    } else if (this.classList.contains('minus')) {
                        if (currentValue > 0) {
                            input.value = currentValue - 1;
                            input.classList.add('pulse');
                            setTimeout(() => input.classList.remove('pulse'), 300);
                        }
                    }

                    if (parseInt(input.value) > 0) {
                        quantityItem.classList.add('selected');
                    } else {
                        quantityItem.classList.remove('selected');
                    }

                    saveProgress();
                });
            });

            // Upload fichiers (installation)
            const fileInput = document.getElementById('fileInput');
            
            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    handleFileUpload(e.target.files, 'uploadedFiles');
                    this.value = '';
                });
            }

            // Upload fichiers (d√©pannage)
            const fileInputDepannage = document.getElementById('fileInputDepannage');
            
            if (fileInputDepannage) {
                fileInputDepannage.addEventListener('change', function(e) {
                    handleFileUpload(e.target.files, 'uploadedFilesDepannage');
                    this.value = '';
                });
            }

            function handleFileUpload(files, containerId) {
                const fileArray = Array.from(files);
                
                if (uploadedFiles.length + fileArray.length > 5) {
                    alert('Maximum 5 photos autoris√©es.');
                    return;
                }

                fileArray.forEach(file => {
                    if (file.size > 5 * 1024 * 1024) {
                        alert(`La photo "${file.name}" est trop lourde (max 5MB).`);
                        return;
                    }

                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        uploadedFiles.push({
                            name: file.name,
                            type: file.type,
                            size: (file.size / 1024).toFixed(0) + ' KB',
                            data: e.target.result.split(',')[1]
                        });
                        
                        displayUploadedFiles(containerId);
                        saveProgress();
                    };
                    
                    reader.readAsDataURL(file);
                });
            }

            function displayUploadedFiles(containerId = 'uploadedFiles') {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                container.innerHTML = uploadedFiles.map((file, index) => `
                    <div class="uploaded-file">
                        <span>üì∑ ${file.name} (${file.size})</span>
                        <span class="uploaded-file-remove" onclick="removeFile(${index})">‚úï</span>
                    </div>
                `).join('');
            }

            window.removeFile = function(index) {
                uploadedFiles.splice(index, 1);
                displayUploadedFiles('uploadedFiles');
                displayUploadedFiles('uploadedFilesDepannage');
                saveProgress();
            };

            // Score de projet
            const delaiSelect = document.getElementById('delaiSelect');
            const projectScore = document.getElementById('projectScore');
            if (delaiSelect) {
                delaiSelect.addEventListener('change', function() {
                    if (this.value === 'urgent') {
                        projectScore.style.display = 'flex';
                    } else {
                        projectScore.style.display = 'none';
                    }
                    saveProgress();
                });
            }

            function updateProgress() {
                if (!activeStepFlow || activeStepFlow.length === 0) return;
                
                // Ne pas afficher la progression sur l'√©tape de succ√®s
                if (currentStep === 8) {
                    return;
                }
                
                const totalStepsInFlow = activeStepFlow.length - 1; // -1 pour exclure l'√©tape de succ√®s
                const percentage = Math.round((currentFlowIndex / totalStepsInFlow) * 100);
                progressBarFill.style.width = percentage + '%';
                progressText.textContent = `√âtape ${currentFlowIndex + 1} sur ${totalStepsInFlow} ‚Ä¢ ${percentage}% compl√©t√©`;
                
                // Am√©lioration 4 : Calcul du temps restant
                const timeRemaining = document.getElementById('timeRemaining');
                if (timeRemaining) {
                    const remainingSteps = totalStepsInFlow - currentFlowIndex;
                    let estimatedTime;
                    
                    if (remainingSteps <= 1) {
                        estimatedTime = '~30s';
                    } else if (remainingSteps <= 2) {
                        estimatedTime = '~1 min';
                    } else if (remainingSteps <= 4) {
                        estimatedTime = '~2 min';
                    } else {
                        estimatedTime = '~3 min';
                    }
                    
                    timeRemaining.textContent = `‚è±Ô∏è ${estimatedTime}`;
                }
            }

            function generateRecap() {
                const recapContent = document.getElementById('recapContent');
                const recapSection = document.getElementById('recapSection');
                let html = '';

                // Type de projet
                if (projectType === 'installation') {
                    html += `<div class="recap-item">Type : Installation / R√©novation</div>`;
                    
                    // Menuiseries
                    const menuiseries = [];
                    document.querySelectorAll('#saunier-form-container input[name^="qty_"]').forEach(input => {
                        const qty = parseInt(input.value);
                        if (qty > 0) {
                            const label = input.closest('.quantity-item').querySelector('.quantity-label').textContent;
                            menuiseries.push(`${qty} ${label}${qty > 1 ? 's' : ''}`);
                        }
                    });
                    if (menuiseries.length > 0) {
                        html += `<div class="recap-item">${menuiseries.join(', ')}</div>`;
                    }

                    const autreProjet = form.querySelector('[name="autreProjet"]')?.value;
                    if (autreProjet) {
                        html += `<div class="recap-item">Autre : ${autreProjet}</div>`;
                    }

                    // Mat√©riaux
                    const materiaux = [];
                    document.querySelectorAll('#saunier-form-container input[name^="materiau_"]:checked').forEach(input => {
                        const label = input.closest('.option-card').querySelector('.title').textContent;
                        materiaux.push(label);
                    });
                    if (materiaux.length > 0) {
                        html += `<div class="recap-item">Mat√©riau(x) : ${materiaux.join(', ')}</div>`;
                    }

                    // Type de bien
                    const typeBien = form.querySelector('[name="typeBien"]');
                    if (typeBien && typeBien.value) {
                        html += `<div class="recap-item">Type : ${typeBien.options[typeBien.selectedIndex].text}</div>`;
                    }

                    // D√©lai
                    const delai = form.querySelector('[name="delai"]');
                    if (delai && delai.value) {
                        html += `<div class="recap-item">D√©lai : ${delai.options[delai.selectedIndex].text}</div>`;
                    }
                } else {
                    html += `<div class="recap-item">Type : ${projectType === 'depannage' ? 'D√©pannage / R√©paration' : 'Autre demande'}</div>`;
                    
                    const description = form.querySelector('[name="descriptionProbleme"]')?.value;
                    if (description) {
                        const shortDesc = description.length > 60 ? description.substring(0, 60) + '...' : description;
                        html += `<div class="recap-item">Description : ${shortDesc}</div>`;
                    }
                }

                // Photos
                if (uploadedFiles.length > 0) {
                    html += `<div class="recap-item">${uploadedFiles.length} photo${uploadedFiles.length > 1 ? 's' : ''} ajout√©e${uploadedFiles.length > 1 ? 's' : ''}</div>`;
                }

                if (html) {
                    recapContent.innerHTML = html;
                    recapSection.style.display = 'block';
                } else {
                    recapSection.style.display = 'none';
                }
            }

            function validateStep(step) {
                const currentStepElement = steps[step];
                
                // Cacher tous les messages d'erreur d'√©tape
                document.querySelectorAll('.step-error-message').forEach(msg => msg.style.display = 'none');
                
                // Validation √©tape 0 (choix du type de projet)
                if (step === 0) {
                    const typeProjet = form.querySelector('input[name="typeProjet"]:checked');
                    if (!typeProjet) {
                        document.getElementById('step0Error').style.display = 'block';
                        setTimeout(() => sendHeightToParent(), 100);
                        return false;
                    }
                    return true;
                }
                
                // Validation √©tape 1 (menuiseries)
                if (step === 1) {
                    const quantities = currentStepElement.querySelectorAll('input[type="number"]');
                    let total = 0;
                    quantities.forEach(input => total += parseInt(input.value));
                    if (total === 0) {
                        document.getElementById('step1Error').style.display = 'block';
                        setTimeout(() => sendHeightToParent(), 100);
                        return false;
                    }
                    return true;
                }

                // Validation √©tape 2 (mat√©riaux)
                if (step === 2) {
                    const checked = currentStepElement.querySelectorAll('input[type="checkbox"]:checked');
                    if (checked.length === 0) {
                        document.getElementById('step2Error').style.display = 'block';
                        setTimeout(() => sendHeightToParent(), 100);
                        return false;
                    }
                    return true;
                }

                // Validation √©tape 3 (type de bien)
                if (step === 3) {
                    const select = document.getElementById('typeBienSelect');
                    if (!select.value) {
                        select.closest('.form-group').classList.add('error');
                        setTimeout(() => sendHeightToParent(), 100);
                        return false;
                    }
                    return true;
                }

                // Validation √©tape 4 (d√©lai)
                if (step === 4) {
                    const select = document.getElementById('delaiSelect');
                    if (!select.value) {
                        select.closest('.form-group').classList.add('error');
                        setTimeout(() => sendHeightToParent(), 100);
                        return false;
                    }
                    return true;
                }
                
                // Validation √©tape 5 (description pour d√©pannage/autre)
                if (step === 5) {
                    const descriptionField = document.getElementById('descriptionProbleme');
                    if (!validateField(descriptionField)) {
                        setTimeout(() => sendHeightToParent(), 100);
                        return false;
                    }
                    return true;
                }
                
                // Validation √©tape 7 (coordonn√©es)
                if (step === 7) {
                    // V√©rifier la checkbox RGPD
                    const rgpdCheckbox = document.getElementById('rgpd');
                    if (!rgpdCheckbox.checked) {
                        document.getElementById('rgpdError').style.display = 'block';
                        rgpdCheckbox.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        setTimeout(() => sendHeightToParent(), 100);
                        return false;
                    }
                }

                // Validation des champs required
                const inputs = currentStepElement.querySelectorAll('input[required], select[required], textarea[required]');
                let hasError = false;
                
                for (let input of inputs) {
                    if (input.type === 'checkbox') {
                        continue; // D√©j√† g√©r√© ci-dessus
                    } else {
                        if (!validateField(input)) {
                            hasError = true;
                            input.focus();
                            break;
                        }
                    }
                }
                
                if (hasError) {
                    setTimeout(() => sendHeightToParent(), 100);
                    return false;
                }
                
                return true;
            }

            function showStep(step) {
                steps.forEach((s, index) => {
                    s.classList.remove('active');
                    if (index === step) s.classList.add('active');
                });

                // Cacher tous les messages d'erreur quand on change d'√©tape
                document.querySelectorAll('.step-error-message').forEach(msg => msg.style.display = 'none');
                document.querySelectorAll('.form-group').forEach(group => group.classList.remove('error'));

                prevBtn.style.display = currentFlowIndex === 0 ? 'none' : 'block';
                
                // Cacher la barre de progression sur l'√©tape de succ√®s
                const progressContainer = document.querySelector('.progress-container');
                if (step === 8) {
                    progressContainer.style.display = 'none';
                    navigationButtons.style.display = 'none';
                } else {
                    progressContainer.style.display = 'block';
                }
                
                // Adapter le texte du bouton
                if (step === 7) {
                    nextBtn.textContent = 'üéÅ Recevoir mon devis gratuit';
                    nextBtn.style.flex = '1';
                    generateRecap();
                } else if (step === 8) {
                    navigationButtons.style.display = 'none';
                } else {
                    nextBtn.textContent = 'Continuer';
                    nextBtn.style.flex = '1';
                }

                updateProgress();
                setTimeout(sendHeightToParent, 100);
            }

            window.goToStep = function(flowIndex) {
                if (!activeStepFlow || flowIndex < 0 || flowIndex >= activeStepFlow.length) return;
                currentFlowIndex = flowIndex;
                currentStep = activeStepFlow[flowIndex];
                showStep(currentStep);
            };

            nextBtn.addEventListener('click', function() {
                // Apr√®s l'√©tape 0, d√©finir le flux et passer √† la premi√®re √©tape du flux
                if (currentStep === 0) {
                    if (!validateStep(currentStep)) {
                        return;
                    }
                    
                    // Le type de projet a d√©j√† √©t√© d√©fini lors du clic sur la carte
                    currentFlowIndex = 1; // Passer √† la deuxi√®me √©tape du flux
                    currentStep = activeStepFlow[currentFlowIndex];
                    showStep(currentStep);
                    saveProgress();
                    return;
                }
                
                // Valider l'√©tape actuelle
                if (!validateStep(currentStep)) {
                    return;
                }
                
                // Si on est √† l'avant-derni√®re √©tape (coordonn√©es), soumettre le formulaire
                if (currentStep === 7) {
                    submitForm();
                    return;
                }
                
                // Passer √† l'√©tape suivante dans le flux
                currentFlowIndex++;
                if (currentFlowIndex < activeStepFlow.length) {
                    currentStep = activeStepFlow[currentFlowIndex];
                    showStep(currentStep);
                    saveProgress();
                }
            });

            prevBtn.addEventListener('click', function() {
                if (currentFlowIndex > 0) {
                    currentFlowIndex--;
                    currentStep = activeStepFlow[currentFlowIndex];
                    showStep(currentStep);
                    saveProgress();
                }
            });

            function submitForm() {
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);
                data.typeProjet = projectType;
                data.uploadedFiles = uploadedFiles;
                data.completionTime = Math.round((Date.now() - startTime) / 1000);
                
                // Collecter les mat√©riaux s√©lectionn√©s (seulement pour installation)
                if (projectType === 'installation') {
                    const materiaux = [];
                    document.querySelectorAll('input[name^="materiau_"]:checked').forEach(input => {
                        materiaux.push(input.value);
                    });
                    data.materiaux = materiaux.join(', ');
                }
                
                // Copier le code postal final vers le champ principal si n√©cessaire
                if (data.codePostalFinal) {
                    data.codePostal = data.codePostalFinal;
                }
                
                // Protection anti-spam
                if (data._honeypot && data._honeypot !== '') {
                    console.log('üö´ Spam d√©tect√© via honeypot');
                    localStorage.removeItem('saunierFormData');
                    currentFlowIndex = activeStepFlow.indexOf(8);
                    currentStep = 8;
                    showStep(currentStep);
                    return;
                }
                
                delete data._honeypot;
                
                console.log('üìä Donn√©es du formulaire:', data);
                
                // Envoi vers Google Sheets
                const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzNjqZAMsrm9SLFIBbAgJkQwfnxGJyf2_zbmmCUZ0HVLcn7AFLRkwNkkMJJ0-B6IQOd/exec';
                
                fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                })
                .then(() => {
                    console.log('‚úÖ Lead envoy√© avec succ√®s vers Google Sheets !');
                    
                    // Am√©lioration 6 : Personnaliser le message de succ√®s selon le type de projet
                    const successTitle = document.getElementById('successTitle');
                    const successMessage = document.getElementById('successMessage');
                    const successBadge = document.getElementById('successBadge');
                    
                    if (projectType === 'installation') {
                        successTitle.textContent = 'üéâ Demande de devis re√ßue !';
                        successMessage.innerHTML = 'Merci pour votre confiance ! <strong>Nous pr√©parons votre devis sur mesure</strong> adapt√© √† vos besoins sp√©cifiques. Notre √©quipe vous recontacte tr√®s prochainement.';
                        successBadge.textContent = 'Chaque devis est √©tudi√© personnellement';
                    } else if (projectType === 'depannage') {
                        successTitle.textContent = 'üö® Demande urgente enregistr√©e !';
                        successMessage.innerHTML = 'Votre demande de d√©pannage a √©t√© <strong>transmise en priorit√© √† notre √©quipe</strong>. Nous vous contactons dans les plus brefs d√©lais pour intervenir rapidement.';
                        successBadge.textContent = 'Notre √©quipe vous contacte en priorit√©';
                    } else {
                        successTitle.textContent = 'üí¨ Demande bien re√ßue !';
                        successMessage.innerHTML = 'Merci pour votre message. <strong>Nos experts analysent votre demande</strong> et vous recontactent tr√®s prochainement avec une r√©ponse adapt√©e.';
                        successBadge.textContent = 'Un conseiller analyse votre demande';
                    }
                    
                    // Signal GTM de conversion
                    try {
                        window.parent.postMessage({
                            'event': 'form_success',
                            'category': 'lead',
                            'action': 'submit',
                            'projectType': projectType
                        }, '*');
                    } catch (e) {
                        console.log('Erreur envoi message parent');
                    }

                    localStorage.removeItem('saunierFormData');
                    currentFlowIndex = activeStepFlow.indexOf(8);
                    currentStep = 8;
                    showStep(currentStep);
                })
                .catch(error => {
                    console.error('‚ùå Erreur envoi lead:', error);
                    
                    // Personnaliser le message m√™me en cas d'erreur
                    const successTitle = document.getElementById('successTitle');
                    const successMessage = document.getElementById('successMessage');
                    const successBadge = document.getElementById('successBadge');
                    
                    if (projectType === 'installation') {
                        successTitle.textContent = 'üéâ Demande de devis re√ßue !';
                        successMessage.innerHTML = 'Merci pour votre confiance ! <strong>Nous pr√©parons votre devis sur mesure</strong> adapt√© √† vos besoins sp√©cifiques. Notre √©quipe vous recontacte tr√®s prochainement.';
                        successBadge.textContent = 'Chaque devis est √©tudi√© personnellement';
                    } else if (projectType === 'depannage') {
                        successTitle.textContent = 'üö® Demande urgente enregistr√©e !';
                        successMessage.innerHTML = 'Votre demande de d√©pannage a √©t√© <strong>transmise en priorit√© √† notre √©quipe</strong>. Nous vous contactons dans les plus brefs d√©lais pour intervenir rapidement.';
                        successBadge.textContent = 'Notre √©quipe vous contacte en priorit√©';
                    } else {
                        successTitle.textContent = 'üí¨ Demande bien re√ßue !';
                        successMessage.innerHTML = 'Merci pour votre message. <strong>Nos experts analysent votre demande</strong> et vous recontactent tr√®s prochainement avec une r√©ponse adapt√©e.';
                        successBadge.textContent = 'Un conseiller analyse votre demande';
                    }
                    
                    // Signal GTM m√™me en cas d'erreur (mode no-cors)
                    try {
                        window.parent.postMessage({
                            'event': 'form_success',
                            'category': 'lead',
                            'action': 'submit',
                            'projectType': projectType
                        }, '*');
                    } catch (e) {
                        console.log('Erreur envoi message parent');
                    }

                    localStorage.removeItem('saunierFormData');
                    currentFlowIndex = activeStepFlow.indexOf(8);
                    currentStep = 8;
                    showStep(currentStep);
                });
            }

            updateProgress();
        })();
    </script>
</body>
</html>
