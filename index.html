<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire Devis - ETS Saunier</title>
    <style>
        /* RESET CSS pour isoler le formulaire */
        #saunier-form-container * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        }

        #saunier-form-container {
            all: initial;
            display: block;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        #saunier-form-container .form-card {
            background: white;
            border-radius: 20px;
            padding: 32px 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            max-width: 650px;
            width: 100%;
            margin: 0 auto;
            overflow: hidden;
        }

        #saunier-form-container .form-header {
            margin-bottom: 20px;
        }

        #saunier-form-container .form-badge {
            display: inline-block;
            background: linear-gradient(135deg, #FF6B35 0%, #FF5722 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 14px;
            box-shadow: 0 4px 12px rgba(255, 87, 34, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        #saunier-form-container .form-title {
            font-size: 26px;
            font-weight: 800;
            color: #1a1a1a;
            margin-bottom: 6px;
            line-height: 1.2;
            letter-spacing: -0.5px;
        }

        #saunier-form-container .form-subtitle {
            font-size: 13px;
            color: #666;
            font-weight: 400;
        }

        #saunier-form-container .step {
            display: none;
        }

        #saunier-form-container .step.active {
            display: block;
            animation: fadeInUp 0.4s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #saunier-form-container .form-group {
            margin-bottom: 14px;
            position: relative;
        }

        #saunier-form-container .form-group.error input,
        #saunier-form-container .form-group.error select,
        #saunier-form-container .form-group.error textarea {
            border-color: #f44336;
            animation: shake 0.3s ease;
        }

        #saunier-form-container .form-group.success input,
        #saunier-form-container .form-group.success select {
            border-color: #4CAF50;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        #saunier-form-container .error-message {
            color: #f44336;
            font-size: 11px;
            margin-top: 4px;
            display: none;
        }

        #saunier-form-container .form-group.error .error-message {
            display: block;
        }

        #saunier-form-container .step-error-message {
            color: #f44336;
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            margin-top: 16px;
            animation: shake 0.3s ease;
        }

        #saunier-form-container .success-icon-inline {
            position: absolute;
            right: 12px;
            top: 34px;
            color: #4CAF50;
            font-size: 16px;
            display: none;
        }

        #saunier-form-container .form-group.success .success-icon-inline {
            display: block;
        }

        #saunier-form-container label {
            display: block;
            margin-bottom: 6px;
            color: #1a1a1a;
            font-weight: 500;
            font-size: 13px;
        }

        #saunier-form-container input[type="text"],
        #saunier-form-container input[type="email"],
        #saunier-form-container input[type="tel"],
        #saunier-form-container select,
        #saunier-form-container textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1.5px solid #e0e0e0;
            border-radius: 10px;
            font-size: 13px;
            transition: all 0.2s ease;
            background: white;
        }

        #saunier-form-container input:focus,
        #saunier-form-container select:focus,
        #saunier-form-container textarea:focus {
            outline: none;
            border-color: #FF5722;
            box-shadow: 0 0 0 3px rgba(255, 87, 34, 0.1);
        }

        #saunier-form-container textarea {
            resize: vertical;
            min-height: 80px;
        }

        #saunier-form-container select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%23666' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            padding-right: 40px;
        }

        #saunier-form-container .quantities-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }

        #saunier-form-container .quantity-item {
            background: #fafafa;
            border: 1.5px solid #e8e8e8;
            border-radius: 12px;
            padding: 12px 8px;
            text-align: center;
            transition: all 0.2s ease;
        }

        #saunier-form-container .quantity-item.selected {
            border-color: #FF5722;
            background: #FFF5F2;
        }

        #saunier-form-container .quantity-item:hover {
            border-color: #FF5722;
            background: #fff;
            box-shadow: 0 4px 12px rgba(255, 87, 34, 0.1);
        }

        #saunier-form-container .quantity-icon {
            color: #FF5722;
            margin-bottom: 6px;
            display: flex;
            justify-content: center;
        }

        #saunier-form-container .quantity-icon svg {
            width: 40px;
            height: 40px;
        }

        /* --- MODIF 1 : Titres des cartes Menuiseries --- */
        #saunier-form-container .quantity-label {
            font-weight: 600;
            color: #1a1a1a;
            font-size: 14px; /* Augment√© √† 14px */
            margin-bottom: 8px;
            min-height: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.1;
        }

        #saunier-form-container .quantity-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        #saunier-form-container .qty-btn {
            width: 32px;
            height: 32px;
            border: 1.5px solid #e8e8e8;
            background: white;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #FF5722;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            min-width: 32px;
            min-height: 32px;
        }

        #saunier-form-container .qty-btn:hover {
            border-color: #FF5722;
            background: #FF5722;
            color: white;
            transform: scale(1.08);
        }

        #saunier-form-container .qty-btn:active {
            transform: scale(0.95);
        }

        #saunier-form-container .quantity-controls input {
            width: 38px;
            text-align: center;
            font-size: 15px;
            font-weight: 700;
            border: none;
            padding: 4px;
            color: #1a1a1a;
            background: transparent;
            transition: transform 0.2s ease;
        }

        #saunier-form-container .quantity-controls input.pulse {
            animation: numberPulse 0.3s ease;
        }

        @keyframes numberPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }

        #saunier-form-container .options-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        #saunier-form-container .option-card {
            border: 1.5px solid #e8e8e8;
            border-radius: 12px;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            background: #fafafa;
        }

        #saunier-form-container .option-card:hover {
            border-color: #FF5722;
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 87, 34, 0.1);
        }

        #saunier-form-container .option-card.selected {
            border-color: #FF5722;
            background: #FFF5F2;
            transform: scale(1.02);
        }

        #saunier-form-container .option-card input[type="checkbox"],
        #saunier-form-container .option-card input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        #saunier-form-container .option-card .icon {
            font-size: 32px;
            margin-bottom: 6px;
            color: #FF5722;
        }

        #saunier-form-container .option-card .icon svg {
            width: 40px;
            height: 40px;
        }

        /* --- MODIF 2 : Titres des cartes Mat√©riaux --- */
        #saunier-form-container .option-card .title {
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 2px;
            font-size: 14px; /* Augment√© √† 14px */
            line-height: 1.2;
        }

        #saunier-form-container .option-card .description {
            font-size: 10px;
            color: #666;
        }

        #saunier-form-container .btn {
            width: 100%;
            padding: 12px 18px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #saunier-form-container .btn-primary {
            background: #FF5722;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        #saunier-form-container .btn-primary:hover {
            background: #E64A19;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 87, 34, 0.4);
        }

        #saunier-form-container .btn-primary:active {
            transform: translateY(0);
        }

        #saunier-form-container .btn-primary::after {
            content: '‚Üí';
            font-size: 16px;
        }

        #saunier-form-container .buttons {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        #saunier-form-container .btn-secondary {
            background: #f5f5f5;
            color: #333;
            flex: 0 0 auto;
            width: auto;
            padding: 12px 20px;
            border-radius: 12px;
        }

        #saunier-form-container .btn-secondary:hover {
            background: #e0e0e0;
        }

        /* Barre de progression */
        #saunier-form-container .progress-container {
            margin-bottom: 16px;
        }

        #saunier-form-container .progress-bar-wrapper {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        #saunier-form-container .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF6B35 0%, #FF5722 100%);
            border-radius: 10px;
            transition: width 0.4s ease;
            width: 0%;
        }

        #saunier-form-container .progress-text {
            text-align: center;
            font-size: 11px;
            color: #999;
            font-weight: 500;
        }

        /* --- MODIF 3 : Titres indicateurs d'√©tapes (ex: üè† Type de bien) --- */
        #saunier-form-container .step-indicator {
            text-align: center;
            color: #555;  /* Rendu plus fonc√© (√©tait #999) */
            font-size: 15px; /* Augment√© √† 15px (√©tait 11px) */
            font-weight: 600; /* Ajout du gras */
            margin-bottom: 12px;
        }

        /* R√©capitulatif */
        #saunier-form-container .recap-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        #saunier-form-container .recap-title {
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 12px;
            font-size: 14px;
        }

        #saunier-form-container .recap-item {
            display: flex;
            align-items: start;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 12px;
            color: #333;
        }

        #saunier-form-container .recap-item::before {
            content: '‚úì';
            color: #4CAF50;
            font-weight: 700;
            flex-shrink: 0;
        }

        #saunier-form-container .recap-edit {
            color: #FF5722;
            text-decoration: underline;
            cursor: pointer;
            font-size: 11px;
            margin-top: 12px;
            display: inline-block;
        }

        /* Score de projet */
        #saunier-form-container .project-score {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-left: 4px solid #FF5722;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #saunier-form-container .project-score-icon {
            font-size: 24px;
        }

        #saunier-form-container .project-score-text {
            font-size: 12px;
            color: #1a1a1a;
            font-weight: 500;
        }

        /* Upload photos */
        #saunier-form-container .file-upload-wrapper {
            border: 2px dashed #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        #saunier-form-container .file-upload-wrapper:hover {
            border-color: #FF5722;
            background: #FFF5F2;
        }

        #saunier-form-container .file-upload-wrapper input[type="file"] {
            display: none;
        }

        #saunier-form-container .file-upload-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        #saunier-form-container .file-upload-text {
            font-size: 12px;
            color: #666;
        }

        #saunier-form-container .uploaded-files {
            margin-top: 10px;
        }

        #saunier-form-container .uploaded-file {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 11px;
        }

        #saunier-form-container .uploaded-file-remove {
            margin-left: auto;
            color: #f44336;
            cursor: pointer;
            font-weight: 600;
        }

        #saunier-form-container .success-message {
            text-align: center;
            padding: 30px 20px;
        }

        #saunier-form-container .success-icon {
            width: 64px;
            height: 64px;
            background: #4CAF50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            animation: scaleIn 0.5s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        #saunier-form-container .success-icon svg {
            width: 36px;
            height: 36px;
            stroke: white;
            stroke-width: 3;
        }

        #saunier-form-container .success-message h2 {
            color: #1a1a1a;
            margin-bottom: 10px;
            font-size: 22px;
        }

        #saunier-form-container .success-message p {
            color: #666;
            line-height: 1.6;
            font-size: 14px;
        }

        #saunier-form-container .form-footer {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
            font-size: 11px;
            color: #999;
            flex-wrap: wrap;
        }

        #saunier-form-container .form-footer-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        #saunier-form-container .form-footer svg {
            width: 14px;
            height: 14px;
        }

        #saunier-form-container .checkbox-group {
            display: flex;
            align-items: start;
            gap: 10px;
            margin-top: 15px;
        }

        #saunier-form-container .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            cursor: pointer;
            accent-color: #FF5722;
            flex-shrink: 0;
        }

        #saunier-form-container .checkbox-group label {
            margin: 0;
            font-size: 12px;
            color: #666;
            font-weight: 400;
            line-height: 1.5;
        }

        #saunier-form-container .checkbox-group label a {
            color: #FF5722;
            text-decoration: underline;
            font-weight: 500;
        }

        #saunier-form-container .checkbox-group label a:hover {
            color: #E64A19;
        }

        @media (max-width: 500px) {
            #saunier-form-container .quantities-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            #saunier-form-container .options-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            #saunier-form-container .form-card {
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            #saunier-form-container .form-card {
                padding: 24px 28px;
                border-radius: 16px;
            }

            #saunier-form-container .quantities-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            #saunier-form-container .quantity-item {
                padding: 10px 6px;
                border-radius: 10px;
            }

            #saunier-form-container .qty-btn {
                width: 30px;
                height: 30px;
                min-width: 30px;
                min-height: 30px;
                border-radius: 7px;
            }

            #saunier-form-container .options-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            #saunier-form-container .option-card {
                padding: 10px 6px;
                border-radius: 10px;
            }

            #saunier-form-container .btn {
                border-radius: 10px;
            }

            #saunier-form-container .btn-secondary {
                border-radius: 10px;
            }

            #saunier-form-container .buttons {
                position: sticky;
                bottom: 0;
                background: white;
                padding: 12px 0;
                margin-left: -16px;
                margin-right: -16px;
                padding-left: 16px;
                padding-right: 16px;
                box-shadow: 0 -4px 12px rgba(0,0,0,0.05);
                border-radius: 16px 16px 0 0;
            }
        }
    </style>
</head>
<body>
    <div id="saunier-form-container">
        <div class="form-card">
            <div class="form-header">
                <div class="form-badge">üìã OBTENEZ VOTRE DEVIS</div>
                <h2 class="form-title">Votre projet, notre expertise</h2>
                <p class="form-subtitle">Faisons le point ensemble</p>
            </div>

            <div class="progress-container">
                <div class="progress-bar-wrapper">
                    <div class="progress-bar-fill" id="progressBarFill"></div>
                </div>
                <div class="progress-text" id="progressText">√âtape 1 sur 6 ‚Ä¢ 17% compl√©t√©</div>
            </div>

            <form id="devisForm">
                <input type="text" name="_honeypot" style="display:none !important" tabindex="-1" autocomplete="off">

                <div class="step active" data-step="1">
                    <div class="step-indicator">ü™ü Vos menuiseries</div>
                    
                    <div class="quantities-grid">
                        <div class="quantity-item" data-type="fenetres">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="12" y="8" width="40" height="48" rx="3" fill="#FFE5E0" stroke="currentColor" stroke-width="2"/>
                                    <line x1="32" y="8" x2="32" y2="56" stroke="currentColor" stroke-width="2"/>
                                    <line x1="12" y1="32" x2="52" y2="32" stroke="currentColor" stroke-width="2"/>
                                    <circle cx="40" cy="32" r="2" fill="currentColor"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Fen√™tre</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="fenetres">‚àí</button>
                                <input type="number" name="qty_fenetres" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="fenetres">+</button>
                            </div>
                        </div>

                        <div class="quantity-item" data-type="portefenetres">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="12" y="8" width="40" height="48" rx="3" fill="#FFE5E0" stroke="currentColor" stroke-width="2"/>
                                    <path d="M32 8v48" stroke="currentColor" stroke-width="2"/>
                                    <rect x="36" y="26" width="12" height="16" rx="1" fill="#FF5722" opacity="0.3"/>
                                    <circle cx="44" cy="34" r="1.5" fill="currentColor"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Porte-fen√™tre</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="portefenetres">‚àí</button>
                                <input type="number" name="qty_portefenetres" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="portefenetres">+</button>
                            </div>
                        </div>

                        <div class="quantity-item" data-type="baie">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="10" y="12" width="44" height="40" rx="3" fill="#FFE5E0" stroke="currentColor" stroke-width="2"/>
                                    <rect x="12" y="14" width="19" height="36" fill="white" opacity="0.7"/>
                                    <rect x="33" y="14" width="19" height="36" fill="white" opacity="0.4"/>
                                    <path d="M31 14v36" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Baie coulissante</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="baie">‚àí</button>
                                <input type="number" name="qty_baie" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="baie">+</button>
                            </div>
                        </div>

                        <div class="quantity-item" data-type="porteentree">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="16" y="8" width="32" height="48" rx="3" fill="#FF8A65" stroke="currentColor" stroke-width="2"/>
                                    <circle cx="40" cy="34" r="2" fill="white"/>
                                    <rect x="20" y="16" width="24" height="10" rx="1.5" fill="#FFE5E0"/>
                                    <path d="M26 34h12M26 38h12M26 42h12" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Porte d'entr√©e</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="porteentree">‚àí</button>
                                <input type="number" name="qty_porteentree" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="porteentree">+</button>
                            </div>
                        </div>

                        <div class="quantity-item" data-type="garage">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="10" y="10" width="44" height="44" rx="3" fill="#FF8A65" stroke="currentColor" stroke-width="2"/>
                                    <rect x="10" y="10" width="44" height="6" fill="#FF5722"/>
                                    <path d="M10 20h44M10 26h44M10 32h44M10 38h44M10 44h44M10 50h44" stroke="#D84315" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Porte de garage</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="garage">‚àí</button>
                                <input type="number" name="qty_garage" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="garage">+</button>
                            </div>
                        </div>

                        <div class="quantity-item" data-type="voletroulant">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="16" y="18" width="32" height="36" rx="2" fill="#FFE5E0" stroke="currentColor" stroke-width="2"/>
                                    <rect x="18" y="10" width="28" height="10" rx="2" fill="#FF8A65" stroke="currentColor" stroke-width="2"/>
                                    <path d="M18 24h28M18 28h28M18 32h28M18 36h28M18 40h28M18 44h28" stroke="#FF5722" stroke-width="1.5"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Volet roulant</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="voletroulant">‚àí</button>
                                <input type="number" name="qty_voletroulant" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="voletroulant">+</button>
                            </div>
                        </div>

                        <div class="quantity-item" data-type="voletbattant">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="8" y="12" width="20" height="40" rx="2" fill="#FF8A65" stroke="currentColor" stroke-width="2"/>
                                    <rect x="36" y="12" width="20" height="40" rx="2" fill="#FF8A65" stroke="currentColor" stroke-width="2"/>
                                    <path d="M10 20h16M10 26h16M10 32h16M10 38h16M10 44h16" stroke="#D84315" stroke-width="1.5"/>
                                    <path d="M38 20h16M38 26h16M38 32h16M38 38h16M38 44h16" stroke="#D84315" stroke-width="1.5"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Volet battant</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="voletbattant">‚àí</button>
                                <input type="number" name="qty_voletbattant" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="voletbattant">+</button>
                            </div>
                        </div>

                        <div class="quantity-item" data-type="portail">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="8" y="16" width="22" height="36" rx="2" fill="#FF8A65" stroke="currentColor" stroke-width="2"/>
                                    <rect x="34" y="16" width="22" height="36" rx="2" fill="#FF8A65" stroke="currentColor" stroke-width="2"/>
                                    <path d="M10 24h18M10 32h18M10 40h18" stroke="#D84315" stroke-width="2"/>
                                    <path d="M36 24h18M36 32h18M36 40h18" stroke="#D84315" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Portail / Cl√¥ture</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="portail">‚àí</button>
                                <input type="number" name="qty_portail" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="portail">+</button>
                            </div>
                        </div>

                        <div class="quantity-item" data-type="pergola">
                            <div class="quantity-icon">
                                <svg viewBox="0 0 64 64" fill="none">
                                    <rect x="8" y="16" width="48" height="36" rx="3" fill="#FFE5E0" stroke="currentColor" stroke-width="2"/>
                                    <line x1="8" y1="16" x2="8" y2="52" stroke="currentColor" stroke-width="3"/>
                                    <line x1="56" y1="16" x2="56" y2="52" stroke="currentColor" stroke-width="3"/>
                                    <path d="M12 22h40M12 28h40M12 34h40" stroke="#FF5722" stroke-width="1.5" opacity="0.5"/>
                                </svg>
                            </div>
                            <div class="quantity-label">Pergola / V√©randa</div>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn minus" data-target="pergola">‚àí</button>
                                <input type="number" name="qty_pergola" value="0" min="0" max="99" readonly>
                                <button type="button" class="qty-btn plus" data-target="pergola">+</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <input type="text" name="autreProjet" placeholder="Autre projet √† pr√©ciser ? (optionnel)">
                    </div>

                    <div class="step-error-message" id="step1Error" style="display: none;">
                        ‚ö†Ô∏è Veuillez s√©lectionner au moins une menuiserie
                    </div>
                </div>

                <div class="step" data-step="2">
                    <div class="step-indicator">üîß Mat√©riau(x) souhait√©(s)</div>
                    
                    <div class="form-group">
                        <label style="margin-bottom: 10px; text-align: center; display: block;">Vous pouvez s√©lectionner plusieurs mat√©riaux</label>
                        <div class="options-grid">
                            <label class="option-card">
                                <input type="checkbox" name="materiau_pvc" value="pvc">
                                <div class="icon">
                                    <svg width="40" height="40" viewBox="0 0 56 56" fill="none">
                                        <rect x="10" y="10" width="36" height="36" rx="4" fill="#FFE5E0" stroke="currentColor" stroke-width="3"/>
                                        <path d="M10 22h36M22 10v36" stroke="currentColor" stroke-width="2.5"/>
                                    </svg>
                                </div>
                                <div class="title">PVC</div>
                                <div class="description">Optimal</div>
                            </label>
                            
                            <label class="option-card">
                                <input type="checkbox" name="materiau_aluminium" value="aluminium">
                                <div class="icon">
                                    <svg width="40" height="40" viewBox="0 0 56 56" fill="none">
                                        <rect x="10" y="10" width="36" height="36" rx="3" fill="#CFD8DC" stroke="#607D8B" stroke-width="3"/>
                                        <circle cx="28" cy="28" r="8" fill="#90A4AE" stroke="#607D8B" stroke-width="2"/>
                                    </svg>
                                </div>
                                <div class="title">Aluminium</div>
                                <div class="description">Moderne</div>
                            </label>
                            
                            <label class="option-card">
                                <input type="checkbox" name="materiau_bois" value="bois">
                                <div class="icon">
                                    <svg width="40" height="40" viewBox="0 0 56 56" fill="none">
                                        <rect x="10" y="10" width="36" height="36" rx="4" fill="#EFEBE9" stroke="#795548" stroke-width="3"/>
                                        <line x1="18" y="10" x2="18" y2="46" stroke="#A1887F" stroke-width="2.5"/>
                                        <line x1="28" y="10" x2="28" y2="46" stroke="#A1887F" stroke-width="2.5"/>
                                        <line x1="38" y="10" x2="38" y2="46" stroke="#A1887F" stroke-width="2.5"/>
                                    </svg>
                                </div>
                                <div class="title">Bois</div>
                                <div class="description">Chaleureux</div>
                            </label>
                            
                            <label class="option-card">
                                <input type="checkbox" name="materiau_mixte" value="mixte">
                                <div class="icon">
                                    <svg width="40" height="40" viewBox="0 0 56 56" fill="none">
                                        <rect x="10" y="10" width="16" height="36" rx="2" fill="#EFEBE9" stroke="#795548" stroke-width="2.5"/>
                                        <rect x="30" y="10" width="16" height="36" rx="2" fill="#CFD8DC" stroke="#607D8B" stroke-width="2.5"/>
                                        <line x1="14" y="10" x2="14" y2="46" stroke="#A1887F" stroke-width="2"/>
                                        <line x1="38" y="10" x2="38" y2="46" stroke="#607D8B" stroke-width="2"/>
                                    </svg>
                                </div>
                                <div class="title">Mixte</div>
                                <div class="description">Alu/Bois</div>
                            </label>
                            
                            <label class="option-card">
                                <input type="checkbox" name="materiau_indecis" value="indecis">
                                <div class="icon">
                                    <svg width="40" height="40" viewBox="0 0 56 56" fill="none">
                                        <circle cx="28" cy="28" r="18" fill="#FFF9C4" stroke="#FBC02D" stroke-width="3"/>
                                        <circle cx="22" cy="24" r="2.5" fill="#F57F17"/>
                                        <circle cx="34" cy="24" r="2.5" fill="#F57F17"/>
                                    </svg>
                                </div>
                                <div class="title">Conseillez-moi</div>
                            </label>
                        </div>
                    </div>

                    <div class="step-error-message" id="step2Error" style="display: none;">
                        ‚ö†Ô∏è Veuillez s√©lectionner au moins un mat√©riau
                    </div>
                </div>

                <div class="step" data-step="3">
                    <div class="step-indicator">üè† Type de bien</div>
                    
                    <div class="form-group">
                        <select name="typeBien" required id="typeBienSelect">
                            <option value="">S√©lectionnez votre type de bien</option>
                            <option value="maison">Maison individuelle</option>
                            <option value="appartement">Appartement</option>
                            <option value="local">Local commercial</option>
                            <option value="neuf">Construction neuve</option>
                        </select>
                        <span class="error-message">Veuillez s√©lectionner un type de bien</span>
                    </div>
                </div>

                <div class="step" data-step="4">
                    <div class="step-indicator">üìÖ D√©lai souhait√©</div>
                    
                    <div class="form-group">
                        <select name="delai" required id="delaiSelect">
                            <option value="">Dans quel d√©lai souhaitez-vous r√©aliser ?</option>
                            <option value="urgent">Le plus t√¥t possible (urgent)</option>
                            <option value="1-3mois">Dans 1 √† 3 mois</option>
                            <option value="3-6mois">Dans 3 √† 6 mois</option>
                            <option value="6mois+">Plus de 6 mois</option>
                        </select>
                        <span class="error-message">Veuillez s√©lectionner un d√©lai</span>
                    </div>

                    <div id="projectScore" class="project-score" style="display: none;">
                        <div class="project-score-icon">üî•</div>
                        <div class="project-score-text">
                            <strong>Projet urgent !</strong><br>
                            Nous vous recontactons en priorit√©
                        </div>
                    </div>
                </div>

                <div class="step" data-step="5">
                    <div class="step-indicator">üìç D√©tails du projet</div>
                    
                    <div class="form-group">
                        <label>Code postal *</label>
                        <input type="text" name="codePostal" id="codePostal" placeholder="Ex: 74000" required pattern="[0-9]{5}" maxlength="5">
                        <span class="error-message">Le code postal doit contenir 5 chiffres</span>
                        <span class="success-icon-inline">‚úì</span>
                    </div>

                    <div class="form-group">
                        <label>Budget pr√©visionnel (optionnel)</label>
                        <select name="budget">
                            <option value="">S√©lectionnez une fourchette</option>
                            <option value="moins-5000">Moins de 5 000 ‚Ç¨</option>
                            <option value="5000-10000">5 000 ‚Ç¨ - 10 000 ‚Ç¨</option>
                            <option value="10000-20000">10 000 ‚Ç¨ - 20 000 ‚Ç¨</option>
                            <option value="plus-20000">Plus de 20 000 ‚Ç¨</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Description du projet (optionnel)</label>
                        <textarea name="description" placeholder="Pr√©cisez vos besoins, contraintes sp√©cifiques, dimensions..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Photos du projet (optionnel)</label>
                        <div class="file-upload-wrapper" onclick="document.getElementById('fileInput').click()">
                            <input type="file" id="fileInput" accept="image/*" multiple>
                            <div class="file-upload-icon">üì∏</div>
                            <div class="file-upload-text">Cliquez pour ajouter des photos<br><small>(JPG, PNG - Max 5 photos)</small></div>
                        </div>
                        <div class="uploaded-files" id="uploadedFiles"></div>
                    </div>
                </div>

                <div class="step" data-step="6">
                    <div class="step-indicator">üéâ Derni√®re √©tape !</div>
                    
                    <div class="recap-section" id="recapSection">
                        <div class="recap-title">üìã R√©capitulatif de votre demande</div>
                        <div id="recapContent"></div>
                        <span class="recap-edit" onclick="goToStep(1)">‚úèÔ∏è Modifier</span>
                    </div>

                    <div class="form-group">
                        <label>Nom *</label>
                        <input type="text" name="nom" id="nom" placeholder="Votre nom" required>
                        <span class="error-message">Le nom est requis</span>
                        <span class="success-icon-inline">‚úì</span>
                    </div>

                    <div class="form-group">
                        <label>Pr√©nom *</label>
                        <input type="text" name="prenom" id="prenom" placeholder="Votre pr√©nom" required>
                        <span class="error-message">Le pr√©nom est requis</span>
                        <span class="success-icon-inline">‚úì</span>
                    </div>

                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" name="email" id="email" placeholder="votre@email.fr" required>
                        <span class="error-message">Format d'email invalide</span>
                        <span class="success-icon-inline">‚úì</span>
                    </div>

                    <div class="form-group">
                        <label>T√©l√©phone *</label>
                        <input type="tel" name="telephone" id="telephone" placeholder="06 00 00 00 00" required pattern="[0-9]{10}" maxlength="10">
                        <span class="error-message">Le t√©l√©phone doit contenir 10 chiffres</span>
                        <span class="success-icon-inline">‚úì</span>
                    </div>

                    <div class="form-group">
                        <label>Cr√©neau de rappel pr√©f√©r√© (optionnel)</label>
                        <select name="creneauRappel">
                            <option value="">Indiff√©rent</option>
                            <option value="matin">Matin (9h-12h)</option>
                            <option value="apres-midi">Apr√®s-midi (14h-17h)</option>
                            <option value="fin-journee">Fin de journ√©e (17h-19h)</option>
                        </select>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" name="rgpd" id="rgpd" required>
                        <label for="rgpd">J'accepte d'√™tre recontact√© pour ma demande de devis et j'ai lu et accept√© les <a href="https://ets-saunier.com/mentions-legales/" target="_blank" style="color: #FF5722; text-decoration: underline;">CGU et la politique de confidentialit√©</a></label>
                    </div>
                    <div class="step-error-message" id="rgpdError" style="display: none; margin-top: 8px;">
                        ‚ö†Ô∏è Vous devez accepter les CGU et la politique de confidentialit√© pour continuer
                    </div>
                </div>

                <div class="step" data-step="7">
                    <div class="success-message">
                        <div class="success-icon">
                            <svg fill="none" viewBox="0 0 24 24">
                                <polyline points="20 6 9 17 4 12" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h2>üéâ Demande envoy√©e !</h2>
                        <p>Merci pour votre confiance. Nous vous recontactons <strong>dans les meilleurs d√©lais</strong> pour affiner votre projet et vous proposer le meilleur devis.</p>
                        <p style="margin-top: 15px; font-size: 12px;">Un conseiller commercial vous contactera prochainement.</p>
                    </div>
                </div>

                <div class="buttons" id="navigationButtons">
                    <button type="button" class="btn btn-secondary" id="prevBtn" style="display: none;">‚Üê Retour</button>
                    <button type="button" class="btn btn-primary" id="nextBtn">Continuer</button>
                </div>
            </form>

            <div class="form-footer">
                <div class="form-footer-item">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span>Devis rapide et personnalis√©</span>
                </div>
                <span>‚Ä¢</span>
                <div class="form-footer-item">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                    </svg>
                    <span>Sans engagement</span>
                </div>
                <span>‚Ä¢</span>
                <div class="form-footer-item">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span>Gratuit</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            const form = document.getElementById('devisForm');
            const steps = document.querySelectorAll('#saunier-form-container .step');
            const nextBtn = document.getElementById('nextBtn');
            const prevBtn = document.getElementById('prevBtn');
            const navigationButtons = document.getElementById('navigationButtons');
            const progressBarFill = document.getElementById('progressBarFill');
            const progressText = document.getElementById('progressText');
            let currentStep = 1;
            const totalSteps = 6;
            let startTime = Date.now();
            let uploadedFiles = [];
            let formStarted = false;

            // LocalStorage
            function saveProgress() {
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);
                data.currentStep = currentStep;
                data.uploadedFiles = uploadedFiles;
                localStorage.setItem('saunierFormData', JSON.stringify(data));
            }

            function loadProgress() {
                const saved = localStorage.getItem('saunierFormData');
                if (saved) {
                    const data = JSON.parse(saved);
                    Object.keys(data).forEach(key => {
                        if (key !== 'currentStep' && key !== 'uploadedFiles') {
                            const input = form.querySelector(`[name="${key}"]`);
                            if (input) {
                                if (input.type === 'checkbox') {
                                    if (data[key]) input.checked = true;
                                } else if (input.type === 'radio') {
                                    const radio = form.querySelector(`[name="${key}"][value="${data[key]}"]`);
                                    if (radio) radio.checked = true;
                                } else {
                                    input.value = data[key];
                                }
                            }
                        }
                    });
                    if (data.uploadedFiles) {
                        uploadedFiles = data.uploadedFiles;
                        displayUploadedFiles();
                    }
                }
            }

            function sendHeightToParent() {
                if (window.parent !== window) {
                    const height = document.body.scrollHeight;
                    window.parent.postMessage({ 
                        type: 'resize-iframe', 
                        height: height 
                    }, '*');
                }
            }

            const resizeObserver = new ResizeObserver(() => {
                sendHeightToParent();
            });
            resizeObserver.observe(document.getElementById('saunier-form-container'));
            
            window.addEventListener('load', () => {
                sendHeightToParent();
                loadProgress();
            });

            // Validation temps r√©el
            function validateField(field) {
                const formGroup = field.closest('.form-group');
                if (!formGroup) return true;

                formGroup.classList.remove('error', 'success');

                if (field.hasAttribute('required') && !field.value.trim()) {
                    if (field.type !== 'checkbox') {
                        formGroup.classList.add('error');
                        return false;
                    }
                }

                if (field.type === 'email' && field.value) {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(field.value)) {
                        formGroup.classList.add('error');
                        return false;
                    }
                }

                if (field.pattern && field.value) {
                    const regex = new RegExp(field.pattern);
                    if (!regex.test(field.value)) {
                        formGroup.classList.add('error');
                        return false;
                    }
                }

                if (field.value) {
                    formGroup.classList.add('success');
                }

                return true;
            }

            document.querySelectorAll('#saunier-form-container input, #saunier-form-container select, #saunier-form-container textarea').forEach(field => {
                field.addEventListener('blur', () => validateField(field));
                field.addEventListener('input', () => {
                    if (field.closest('.form-group')?.classList.contains('error')) {
                        validateField(field);
                    }
                    saveProgress();
                });
            });

            // Auto-format t√©l√©phone
            const telInput = document.getElementById('telephone');
            if (telInput) {
                telInput.addEventListener('input', function(e) {
                    let value = this.value.replace(/\D/g, '');
                    if (value.length > 10) value = value.substr(0, 10);
                    this.value = value;
                });
            }

            // Auto-format code postal
            const cpInput = document.getElementById('codePostal');
            if (cpInput) {
                cpInput.addEventListener('input', function(e) {
                    let value = this.value.replace(/\D/g, '');
                    if (value.length > 5) value = value.substr(0, 5);
                    this.value = value;
                });
            }

            // Gestion des cartes d'options (CHECKBOXES)
            document.querySelectorAll('#saunier-form-container .option-card').forEach(card => {
                card.addEventListener('click', function() {
                    const input = this.querySelector('input');
                    input.checked = !input.checked;
                    
                    if (input.checked) {
                        this.classList.add('selected');
                    } else {
                        this.classList.remove('selected');
                    }
                    
                    saveProgress();
                });
            });

            // Gestion quantit√©s
            document.querySelectorAll('#saunier-form-container .qty-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    if (!formStarted) {
                        formStarted = true;
                    }
                    
                    const target = this.dataset.target;
                    const input = document.querySelector(`#saunier-form-container input[name="qty_${target}"]`);
                    const quantityItem = input.closest('.quantity-item');
                    const currentValue = parseInt(input.value);
                    
                    if (this.classList.contains('plus')) {
                        if (currentValue < 99) {
                            input.value = currentValue + 1;
                            input.classList.add('pulse');
                            setTimeout(() => input.classList.remove('pulse'), 300);
                        }
                    } else if (this.classList.contains('minus')) {
                        if (currentValue > 0) {
                            input.value = currentValue - 1;
                            input.classList.add('pulse');
                            setTimeout(() => input.classList.remove('pulse'), 300);
                        }
                    }

                    if (parseInt(input.value) > 0) {
                        quantityItem.classList.add('selected');
                    } else {
                        quantityItem.classList.remove('selected');
                    }

                    saveProgress();
                });
            });

            // Upload fichiers
            const fileInput = document.getElementById('fileInput');
            fileInput.addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                if (uploadedFiles.length + files.length > 5) {
                    alert('Maximum 5 photos');
                    return;
                }
                files.forEach(file => {
                    if (file.size > 5 * 1024 * 1024) {
                        alert('Fichier trop volumineux (max 5MB)');
                        return;
                    }
                    uploadedFiles.push({
                        name: file.name,
                        size: (file.size / 1024).toFixed(0) + ' KB'
                    });
                });
                displayUploadedFiles();
                saveProgress();
            });

            function displayUploadedFiles() {
                const container = document.getElementById('uploadedFiles');
                container.innerHTML = uploadedFiles.map((file, index) => `
                    <div class="uploaded-file">
                        <span>üì∑ ${file.name} (${file.size})</span>
                        <span class="uploaded-file-remove" onclick="removeFile(${index})">‚úï</span>
                    </div>
                `).join('');
            }

            window.removeFile = function(index) {
                uploadedFiles.splice(index, 1);
                displayUploadedFiles();
                saveProgress();
            };

            // Score de projet
            const delaiSelect = document.getElementById('delaiSelect');
            const projectScore = document.getElementById('projectScore');
            delaiSelect.addEventListener('change', function() {
                if (this.value === 'urgent') {
                    projectScore.style.display = 'flex';
                } else {
                    projectScore.style.display = 'none';
                }
                saveProgress();
            });

            function updateProgress() {
                // Ne pas afficher la progression sur l'√©tape de succ√®s
                if (currentStep > totalSteps) {
                    return;
                }
                const percentage = Math.round((currentStep / totalSteps) * 100);
                progressBarFill.style.width = percentage + '%';
                progressText.textContent = `√âtape ${currentStep} sur ${totalSteps} ‚Ä¢ ${percentage}% compl√©t√©`;
            }

            function generateRecap() {
                const recapContent = document.getElementById('recapContent');
                let html = '';

                // Menuiseries
                const menuiseries = [];
                document.querySelectorAll('#saunier-form-container input[name^="qty_"]').forEach(input => {
                    const qty = parseInt(input.value);
                    if (qty > 0) {
                        const label = input.closest('.quantity-item').querySelector('.quantity-label').textContent;
                        menuiseries.push(`${qty} ${label}${qty > 1 ? 's' : ''}`);
                    }
                });
                if (menuiseries.length > 0) {
                    html += `<div class="recap-item">${menuiseries.join(', ')}</div>`;
                }

                const autreProjet = form.querySelector('[name="autreProjet"]').value;
                if (autreProjet) {
                    html += `<div class="recap-item">Autre : ${autreProjet}</div>`;
                }

                // Mat√©riaux (checkboxes)
                const materiaux = [];
                document.querySelectorAll('#saunier-form-container input[name^="materiau_"]:checked').forEach(input => {
                    const label = input.closest('.option-card').querySelector('.title').textContent;
                    materiaux.push(label);
                });
                if (materiaux.length > 0) {
                    html += `<div class="recap-item">Mat√©riau(x) : ${materiaux.join(', ')}</div>`;
                }

                // Type de bien
                const typeBien = form.querySelector('[name="typeBien"]');
                if (typeBien.value) {
                    html += `<div class="recap-item">Type : ${typeBien.options[typeBien.selectedIndex].text}</div>`;
                }

                // D√©lai
                const delai = form.querySelector('[name="delai"]');
                if (delai.value) {
                    html += `<div class="recap-item">D√©lai : ${delai.options[delai.selectedIndex].text}</div>`;
                }

                // Code postal
                const cp = form.querySelector('[name="codePostal"]').value;
                if (cp) {
                    html += `<div class="recap-item">Code postal : ${cp}</div>`;
                }

                // Photos
                if (uploadedFiles.length > 0) {
                    html += `<div class="recap-item">${uploadedFiles.length} photo${uploadedFiles.length > 1 ? 's' : ''} ajout√©e${uploadedFiles.length > 1 ? 's' : ''}</div>`;
                }

                recapContent.innerHTML = html;
            }

            function validateStep(step) {
                const currentStepElement = steps[step - 1];
                
                // Cacher tous les messages d'erreur d'√©tape
                document.querySelectorAll('.step-error-message').forEach(msg => msg.style.display = 'none');
                
                if (step === 1) {
                    const quantities = currentStepElement.querySelectorAll('input[type="number"]');
                    let total = 0;
                    quantities.forEach(input => total += parseInt(input.value));
                    if (total === 0) {
                        document.getElementById('step1Error').style.display = 'block';
                        setTimeout(() => sendHeightToParent(), 100);
                        return false;
                    }
                    return true;
                }

                if (step === 2) {
                    const checked = currentStepElement.querySelectorAll('input[type="checkbox"]:checked');
                    if (checked.length === 0) {
                        document.getElementById('step2Error').style.display = 'block';
                        setTimeout(() => sendHeightToParent(), 100);
                        return false;
                    }
                    return true;
                }

                if (step === 3) {
                    const select = document.getElementById('typeBienSelect');
                    if (!select.value) {
                        select.closest('.form-group').classList.add('error');
                        setTimeout(() => sendHeightToParent(), 100);
                        return false;
                    }
                    return true;
                }

                if (step === 4) {
                    const select = document.getElementById('delaiSelect');
                    if (!select.value) {
                        select.closest('.form-group').classList.add('error');
                        setTimeout(() => sendHeightToParent(), 100);
                        return false;
                    }
                    return true;
                }
                
                if (step === 6) {
                    // V√©rifier la checkbox RGPD
                    const rgpdCheckbox = document.getElementById('rgpd');
                    if (!rgpdCheckbox.checked) {
                        document.getElementById('rgpdError').style.display = 'block';
                        rgpdCheckbox.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        setTimeout(() => sendHeightToParent(), 100);
                        return false;
                    }
                }

                // Validation des champs required
                const inputs = currentStepElement.querySelectorAll('input[required], select[required]');
                let hasError = false;
                
                for (let input of inputs) {
                    if (input.type === 'checkbox') {
                        continue; // D√©j√† g√©r√© ci-dessus
                    } else {
                        if (!validateField(input)) {
                            hasError = true;
                            input.focus();
                            break;
                        }
                    }
                }
                
                if (hasError) {
                    setTimeout(() => sendHeightToParent(), 100);
                    return false;
                }
                
                return true;
            }

            function showStep(step) {
                steps.forEach((s, index) => {
                    s.classList.remove('active');
                    if (index === step - 1) s.classList.add('active');
                });

                // Cacher tous les messages d'erreur quand on change d'√©tape
                document.querySelectorAll('.step-error-message').forEach(msg => msg.style.display = 'none');
                document.querySelectorAll('.form-group').forEach(group => group.classList.remove('error'));

                prevBtn.style.display = step === 1 ? 'none' : 'block';
                
                // Cacher la barre de progression sur l'√©tape de succ√®s
                const progressContainer = document.querySelector('.progress-container');
                if (step === totalSteps + 1) {
                    progressContainer.style.display = 'none';
                    navigationButtons.style.display = 'none';
                } else {
                    progressContainer.style.display = 'block';
                }
                
                if (step === totalSteps) {
                    nextBtn.textContent = 'üéÅ Recevoir mon devis gratuit';
                    nextBtn.style.flex = '1';
                    generateRecap();
                } else if (step === totalSteps + 1) {
                    navigationButtons.style.display = 'none';
                } else {
                    nextBtn.textContent = 'Continuer';
                    nextBtn.style.flex = '1';
                }

                updateProgress();
                setTimeout(sendHeightToParent, 100);
            }

            window.goToStep = function(step) {
                currentStep = step;
                showStep(currentStep);
            };

            nextBtn.addEventListener('click', function() {
                if (currentStep <= totalSteps) {
                    if (!validateStep(currentStep)) {
                        return;
                    }

                    if (currentStep === totalSteps) {
                        submitForm();
                    } else {
                        currentStep++;
                        showStep(currentStep);
                        saveProgress();
                    }
                }
            });

            prevBtn.addEventListener('click', function() {
                if (currentStep > 1) {
                    currentStep--;
                    showStep(currentStep);
                    saveProgress();
                }
            });

            function submitForm() {
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);
                data.uploadedFiles = uploadedFiles;
                data.completionTime = Math.round((Date.now() - startTime) / 1000);
                
                // Collecter les mat√©riaux s√©lectionn√©s
                const materiaux = [];
                document.querySelectorAll('input[name^="materiau_"]:checked').forEach(input => {
                    materiaux.push(input.value);
                });
                data.materiaux = materiaux.join(', ');
                
                // üõ°Ô∏è PROTECTION ANTI-SPAM - V√©rifier le honeypot
                if (data._honeypot && data._honeypot !== '') {
                    console.log('üö´ Spam d√©tect√© via honeypot');
                    // Ne rien faire, c'est un bot
                    // Mais afficher quand m√™me le message de succ√®s pour ne pas alerter le bot
                    localStorage.removeItem('saunierFormData');
                    currentStep = 7;
                    showStep(currentStep);
                    return;
                }
                
                // Supprimer le honeypot avant d'envoyer les vraies donn√©es
                delete data._honeypot;
                
                console.log('üìä Donn√©es du formulaire:', data);
                
                // üì® ENVOI VERS GOOGLE SHEETS
                const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwD2fDcuGUKI7EdUYnGj5KdIXQa0pesNHqcPUsEwLI4TQQyq1S7jy2Tp2dYOx9ZhW5r/exec';
                
                fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Obligatoire pour Google Apps Script
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                })
                .then(() => {
                    console.log('‚úÖ Lead envoy√© avec succ√®s vers Google Sheets !');
                    
                    // --- AJOUT POUR GTM : ENVOI DU SIGNAL DE CONVERSION ---
                    // A d√©clencher quand le formulaire est valid√© et le message affich√©
                    try {
                        window.parent.postMessage({
                        'event': 'form_success',
                        'category': 'lead',
                        'action': 'submit'
                        }, '*');
                    } catch (e) {
                        console.log('Erreur envoi message parent');
                    }
                    // -----------------------------------------------------

                    localStorage.removeItem('saunierFormData');
                    currentStep = 7;
                    showStep(currentStep);
                })
                .catch(error => {
                    console.error('‚ùå Erreur envoi lead:', error);
                    // Afficher quand m√™me le message de succ√®s (mode no-cors ne retourne pas de r√©ponse)
                    
                    // --- AU CAS OU (SI ERREUR RESEAU MAIS SUCCES AFFICHE) ---
                    try {
                        window.parent.postMessage({
                        'event': 'form_success',
                        'category': 'lead',
                        'action': 'submit'
                        }, '*');
                    } catch (e) {
                        console.log('Erreur envoi message parent');
                    }
                    // -----------------------------------------------------

                    localStorage.removeItem('saunierFormData');
                    currentStep = 7;
                    showStep(currentStep);
                });
            }

            updateProgress();
        })();
    </script>
</body>
</html>
